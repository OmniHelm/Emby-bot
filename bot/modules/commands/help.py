"""
å¸®åŠ©å‘½ä»¤æ¨¡å—
æä¾› /help å’Œ /faq å‘½ä»¤
"""

from pyrogram import filters
from bot import bot, prefixes, sakura_b
from bot.func_helper.msg_utils import sendMessage, deleteMessage
from bot.func_helper.filters import user_in_group_on_filter
from bot.func_helper.fix_bottons import ikb
from bot.constants.messages import Messages


# /help å‘½ä»¤ - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
@bot.on_message(filters.command('help', prefixes) & user_in_group_on_filter)
async def help_command(_, msg):
    """æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å’Œå‘½ä»¤åˆ—è¡¨"""
    await deleteMessage(msg)

    help_text = f"""
ğŸ“š **EmbyBot å¸®åŠ©ä¸­å¿ƒ**

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚  ğŸ’¡ **å¿«é€Ÿå¸®åŠ©**
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

**å¸¸ç”¨å‘½ä»¤ï¼š**
â€¢ `/start` - æ‰“å¼€ä¸»é¢æ¿
â€¢ `/help` - æŸ¥çœ‹æœ¬å¸®åŠ©
â€¢ `/faq` - å¸¸è§é—®é¢˜è§£ç­”
â€¢ `/exchange` - å…‘æ¢æ³¨å†Œç /ç»­æœŸç 
â€¢ `/myinfo` - æŸ¥çœ‹æˆ‘çš„ä¿¡æ¯ï¼ˆç¾¤ç»„ï¼‰
â€¢ `/count` - æŸ¥çœ‹åª’ä½“ç»Ÿè®¡

---

**å¿«é€Ÿå¼€å§‹ï¼š**

**1ï¸âƒ£ åˆ›å»ºè´¦æˆ·**
   ä¸»é¢æ¿ â†’ ğŸ¨ åˆ›å»ºè´¦æˆ·
   è¾“å…¥ï¼š`ç”¨æˆ·å å®‰å…¨ç `
   ç¤ºä¾‹ï¼š`å¼ ä¸‰ 1234`

**2ï¸âƒ£ ç™»å½• Emby**
   ä¸‹è½½ Emby å®¢æˆ·ç«¯
   ä½¿ç”¨è´¦æˆ·ä¿¡æ¯ç™»å½•
   å¼€å§‹è§‚çœ‹å½±ç‰‡

**3ï¸âƒ£ ç»­æœŸè´¦æˆ·**
   ä½¿ç”¨ç»­æœŸç ï¼š`/exchange ç»­æœŸç `
   æˆ–åœ¨å…‘æ¢å•†åº—å…‘æ¢

---

**ç”¨æˆ·åŠŸèƒ½ï¼š**
â€¢ ğŸ’– æˆ‘çš„æ”¶è— - æŸ¥çœ‹æ”¶è—çš„å½±ç‰‡
â€¢ ğŸ’  æˆ‘çš„è®¾å¤‡ - ç®¡ç†ç™»å½•è®¾å¤‡
â€¢ ğŸ”‘ é‡ç½®å¯†ç  - å¿˜è®°å¯†ç æ—¶ä½¿ç”¨
â€¢ ğŸ¬ æ˜¾ç¤º/éšè— - è‡ªå®šä¹‰åª’ä½“åº“
â€¢ ğŸª å…‘æ¢å•†åº— - ä½¿ç”¨{sakura_b}å…‘æ¢

---

**è´¦æˆ·è§„åˆ™ï¼š**
â€¢ ç”¨æˆ·åï¼šæ”¯æŒä¸­è‹±æ–‡ï¼Œ2-20å­—ç¬¦
â€¢ å®‰å…¨ç ï¼š4-6ä½æ•°å­—
â€¢ åŒæ—¶æ’­æ”¾ï¼šæœ€å¤š2å°è®¾å¤‡
â€¢ å¯†ç ï¼šä»…æ˜¾ç¤ºä¸€æ¬¡ï¼Œè¯·å¦¥å–„ä¿ç®¡

---

**è·å–{sakura_b}ï¼š**
â€¢ ğŸ¯ æ¯æ—¥ç­¾åˆ°
â€¢ âœ… å®Œæˆä»»åŠ¡
â€¢ ğŸ‘¥ é‚€è¯·å¥½å‹
â€¢ ğŸŠ å‚ä¸æ´»åŠ¨

---

**éœ€è¦æ›´å¤šå¸®åŠ©ï¼Ÿ**

ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£
"""

    # åˆ›å»ºå¸®åŠ©æŒ‰é’®
    help_buttons = ikb([
        [('ğŸ“– ç”¨æˆ·æŒ‡å—', 'help_guide', 'url' if False else None),
         ('â“ å¸¸è§é—®é¢˜', 'help_faq')],
        [('ğŸ¯ å¿«é€Ÿå¼€å§‹', 'help_quickstart'),
         ('ğŸ’¬ è”ç³»ç®¡ç†', 'help_contact')],
        [('âŒ å…³é—­', 'closeit')]
    ])

    await sendMessage(msg, help_text, buttons=help_buttons, timer=180)


# /faq å‘½ä»¤ - å¸¸è§é—®é¢˜
@bot.on_message(filters.command('faq', prefixes) & user_in_group_on_filter)
async def faq_command(_, msg):
    """æ˜¾ç¤ºå¸¸è§é—®é¢˜è§£ç­”"""
    await deleteMessage(msg)

    faq_text = f"""
â“ **å¸¸è§é—®é¢˜è§£ç­” (FAQ)**

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚  ğŸ” **çƒ­é—¨é—®é¢˜**
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

**Q1: å¦‚ä½•åˆ›å»º Emby è´¦æˆ·ï¼Ÿ**
A: `/start` â†’ ğŸ¨ åˆ›å»ºè´¦æˆ· â†’ è¾“å…¥ `ç”¨æˆ·å å®‰å…¨ç `

**Q2: å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ**
A: ä¸»é¢æ¿ â†’ ğŸ‘¤ ç”¨æˆ·åŠŸèƒ½ â†’ ğŸ”‘ é‡ç½®å¯†ç 

**Q3: å¦‚ä½•ç»­æœŸè´¦æˆ·ï¼Ÿ**
A: ä½¿ç”¨å‘½ä»¤ `/exchange ç»­æœŸç `
   æˆ–åœ¨ ğŸª å…‘æ¢å•†åº— ä½¿ç”¨{sakura_b}å…‘æ¢

**Q4: è´¦æˆ·åˆ°æœŸåä¼šæ€æ ·ï¼Ÿ**
A: â€¢ æ— æ³•ç™»å½• Emby æœåŠ¡å™¨
   â€¢ æ•°æ®ä¿ç•™ 7 å¤©
   â€¢ 7 å¤©å†…ç»­æœŸå¯æ¢å¤

**Q5: å¯ä»¥åœ¨å¤šä¸ªè®¾å¤‡ä¸Šä½¿ç”¨å—ï¼Ÿ**
A: â€¢ å¯ä»¥åœ¨å¤šä¸ªè®¾å¤‡ç™»å½•
   â€¢ åŒæ—¶æ’­æ”¾é™åˆ¶ 2 å°è®¾å¤‡
   â€¢ æŸ¥çœ‹è®¾å¤‡ï¼šğŸ’  æˆ‘çš„è®¾å¤‡

**Q6: è§†é¢‘å¡é¡¿æ€ä¹ˆåŠï¼Ÿ**
A: 1ï¸âƒ£ é™ä½ç”»è´¨åˆ° 720P/480P
   2ï¸âƒ£ å¼€å¯è½¬ç æ’­æ”¾
   3ï¸âƒ£ æ›´æ¢æœåŠ¡å™¨çº¿è·¯
   4ï¸âƒ£ æ£€æŸ¥ç½‘ç»œé€Ÿåº¦

**Q7: å¦‚ä½•è·å–{sakura_b}ï¼Ÿ**
A: â€¢ ğŸ¯ æ¯æ—¥ç­¾åˆ°
   â€¢ âœ… å®Œæˆä»»åŠ¡
   â€¢ ğŸ‘¥ é‚€è¯·å¥½å‹æ³¨å†Œ
   â€¢ ğŸŠ å‚ä¸ç¾¤ç»„æ´»åŠ¨

**Q8: å¿˜è®°å®‰å…¨ç æ€ä¹ˆåŠï¼Ÿ**
A: åªèƒ½è”ç³»ç®¡ç†å‘˜ååŠ©é‡ç½®
   æä¾› Telegram ID éªŒè¯èº«ä»½

**Q9: å¯ä»¥ä¿®æ”¹ç”¨æˆ·åå—ï¼Ÿ**
A: ä¸å¯ä»¥ï¼Œç”¨æˆ·ååˆ›å»ºåæ— æ³•ä¿®æ”¹
   åªèƒ½åˆ é™¤æ—§è´¦æˆ·é‡æ–°åˆ›å»º

**Q10: å¦‚ä½•åˆ é™¤è´¦æˆ·ï¼Ÿ**
A: ä¸»é¢æ¿ â†’ ğŸ‘¤ ç”¨æˆ·åŠŸèƒ½ â†’ ğŸ—‘ï¸ åˆ é™¤è´¦å·
   âš ï¸ æ­¤æ“ä½œæ— æ³•æ’¤é”€

---

**æ›´å¤šé—®é¢˜ï¼Ÿ**

ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æŸ¥çœ‹å®Œæ•´ FAQ
"""

    faq_buttons = ikb([
        [('ğŸ“š å®Œæ•´ FAQ', 'faq_full'),
         ('ğŸ“– ç”¨æˆ·æŒ‡å—', 'help_guide')],
        [('ğŸ’¬ è”ç³»ç®¡ç†å‘˜', 'help_contact'),
         ('âŒ å…³é—­', 'closeit')]
    ])

    await sendMessage(msg, faq_text, buttons=faq_buttons, timer=180)


# /guide å‘½ä»¤ - ç”¨æˆ·æŒ‡å—
@bot.on_message(filters.command('guide', prefixes) & user_in_group_on_filter)
async def guide_command(_, msg):
    """æ˜¾ç¤ºç”¨æˆ·æŒ‡å—"""
    await deleteMessage(msg)

    guide_text = f"""
ğŸ“– **EmbyBot ç”¨æˆ·æŒ‡å—**

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚  ğŸ¬ **ä½¿ç”¨æ•™ç¨‹**
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

**ğŸ“± å®¢æˆ·ç«¯ä¸‹è½½ï¼š**

**iOS è®¾å¤‡ï¼š**
â€¢ App Store æœç´¢ "Emby"
â€¢ æˆ–ä½¿ç”¨ Infuseï¼ˆæ¨èï¼‰

**Android è®¾å¤‡ï¼š**
â€¢ Google Play æœç´¢ "Emby"
â€¢ æˆ–å„å¤§åº”ç”¨å•†åº—

**ç”µè„‘ï¼š**
â€¢ è®¿é—® emby.media ä¸‹è½½
â€¢ æˆ–ä½¿ç”¨ç½‘é¡µç‰ˆ

**ç”µè§†/ç›’å­ï¼š**
â€¢ Android TV åº”ç”¨å•†åº—
â€¢ Apple TV App Store

---

**ğŸ”§ ç™»å½•æ­¥éª¤ï¼š**

**1. æ·»åŠ æœåŠ¡å™¨**
   ç‚¹å‡»"æ·»åŠ æœåŠ¡å™¨"
   è¾“å…¥æœåŠ¡å™¨åœ°å€
   ï¼ˆåœ¨ ğŸŒ æœåŠ¡å™¨ ä¸­æŸ¥çœ‹ï¼‰

**2. è¾“å…¥è´¦æˆ·**
   ç”¨æˆ·åï¼šä½ çš„ Emby ç”¨æˆ·å
   å¯†ç ï¼šåˆ›å»ºè´¦æˆ·æ—¶çš„å¯†ç 

**3. å¼€å§‹ä½¿ç”¨**
   æµè§ˆåª’ä½“åº“
   æ’­æ”¾å–œæ¬¢çš„å½±ç‰‡

---

**âš™ï¸ æ¨èè®¾ç½®ï¼š**

**ç”»è´¨è®¾ç½®ï¼š**
â€¢ WiFiï¼š1080P æˆ–åŸç”»
â€¢ ç§»åŠ¨ç½‘ç»œï¼š720P
â€¢ æ…¢é€Ÿç½‘ç»œï¼š480P

**æ’­æ”¾è®¾ç½®ï¼š**
â€¢ å¼€å¯ç¡¬ä»¶åŠ é€Ÿ
â€¢ å¯ç”¨è‡ªåŠ¨è½¬ç 
â€¢ è°ƒæ•´ç¼“å†²æ—¶é—´

**å­—å¹•è®¾ç½®ï¼š**
â€¢ é€‰æ‹©åˆé€‚çš„å­—ä½“å¤§å°
â€¢ è°ƒæ•´å­—å¹•ä½ç½®
â€¢ è®¾ç½®å­—å¹•å»¶è¿Ÿ

---

**ğŸ’¡ ä½¿ç”¨æŠ€å·§ï¼š**

**1. æ”¶è—åŠŸèƒ½**
   çœ‹åˆ°å–œæ¬¢çš„å°±æ”¶è—
   æ–¹ä¾¿ä¸‹æ¬¡å¿«é€Ÿæ‰¾åˆ°

**2. ç»§ç»­è§‚çœ‹**
   è§‚çœ‹è¿›åº¦è‡ªåŠ¨ä¿å­˜
   è·¨è®¾å¤‡åŒæ­¥

**3. ä¸‹è½½ç¦»çº¿**
   WiFi ä¸‹ä¸‹è½½è§†é¢‘
   éšæ—¶éšåœ°è§‚çœ‹

**4. å¤šè®¾å¤‡åŒæ­¥**
   æ”¶è—ã€è¿›åº¦è‡ªåŠ¨åŒæ­¥
   æ— ç¼åˆ‡æ¢è®¾å¤‡

---

**ğŸ” å®‰å…¨æç¤ºï¼š**

â€¢ ä¸è¦åˆ†äº«è´¦æˆ·ç»™ä»–äºº
â€¢ å®šæœŸæ›´æ¢å¯†ç 
â€¢ å‘ç°å¼‚å¸¸ç«‹å³é‡ç½®
â€¢ å®šæœŸæ£€æŸ¥ç™»å½•è®¾å¤‡

---

**ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ**

â€¢ æŸ¥çœ‹ FAQï¼š`/faq`
â€¢ è”ç³»ç®¡ç†å‘˜
â€¢ åœ¨ç¾¤ç»„æé—®
"""

    guide_buttons = ikb([
        [('â“ å¸¸è§é—®é¢˜', 'help_faq'),
         ('ğŸ’¬ è”ç³»ç®¡ç†', 'help_contact')],
        [('âŒ å…³é—­', 'closeit')]
    ])

    await sendMessage(msg, guide_text, buttons=guide_buttons, timer=180)


# å›è°ƒæŸ¥è¯¢å¤„ç†
@bot.on_callback_query(filters.regex('^help_'))
async def help_callback(_, call):
    """å¤„ç†å¸®åŠ©ç›¸å…³çš„å›è°ƒ"""
    action = call.data

    if action == 'help_faq':
        # æ˜¾ç¤º FAQ
        await faq_command(_, call.message)

    elif action == 'help_guide':
        # æ˜¾ç¤ºç”¨æˆ·æŒ‡å—
        await guide_command(_, call.message)

    elif action == 'help_quickstart':
        # å¿«é€Ÿå¼€å§‹
        quickstart_text = f"""
ğŸš€ **å¿«é€Ÿå¼€å§‹æŒ‡å—**

**æ­¥éª¤ 1: åˆ›å»ºè´¦æˆ·**
1. ç‚¹å‡» `/start`
2. ç‚¹å‡» ğŸ¨ åˆ›å»ºè´¦æˆ·
3. è¾“å…¥ï¼š`ç”¨æˆ·å å®‰å…¨ç `
   ç¤ºä¾‹ï¼š`å¼ ä¸‰ 1234`
4. è®°å½•å¯†ç ï¼ˆä»…æ˜¾ç¤ºä¸€æ¬¡ï¼‰

**æ­¥éª¤ 2: ä¸‹è½½å®¢æˆ·ç«¯**
â€¢ iOS: App Store æœç´¢ "Emby"
â€¢ Android: Google Play æœç´¢ "Emby"
â€¢ ç”µè„‘: è®¿é—® emby.media

**æ­¥éª¤ 3: ç™»å½•**
1. æ‰“å¼€ Emby å®¢æˆ·ç«¯
2. æ·»åŠ æœåŠ¡å™¨ï¼ˆåœ¨ ğŸŒ æœåŠ¡å™¨ ä¸­æŸ¥çœ‹åœ°å€ï¼‰
3. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
4. å¼€å§‹è§‚çœ‹

**æ­¥éª¤ 4: ç»­æœŸï¼ˆé‡è¦ï¼‰**
â€¢ è´¦æˆ·æœ‰æœ‰æ•ˆæœŸ
â€¢ åˆ°æœŸå‰ä¼šæ”¶åˆ°æé†’
â€¢ ä½¿ç”¨ç»­æœŸç ï¼š`/exchange ç»­æœŸç `
â€¢ æˆ–åœ¨ ğŸª å…‘æ¢å•†åº— å…‘æ¢

**è·å–{sakura_b}ï¼š**
â€¢ ğŸ¯ æ¯æ—¥ç­¾åˆ°
â€¢ ğŸ‘¥ é‚€è¯·å¥½å‹
â€¢ ğŸŠ å‚ä¸æ´»åŠ¨

å°±è¿™ä¹ˆç®€å•ï¼å¼€å§‹äº«å—å§ ğŸ¬
"""
        back_button = ikb([[('â†©ï¸ è¿”å›å¸®åŠ©', 'help_back'), ('âŒ å…³é—­', 'closeit')]])
        await call.message.edit(quickstart_text, reply_markup=back_button)

    elif action == 'help_contact':
        # è”ç³»ç®¡ç†
        contact_text = """
ğŸ’¬ **è”ç³»æ”¯æŒ**

**è·å–å¸®åŠ©çš„æ–¹å¼ï¼š**

**1. æŸ¥çœ‹æ–‡æ¡£**
   â€¢ ç”¨æˆ·æŒ‡å—ï¼š`/guide`
   â€¢ å¸¸è§é—®é¢˜ï¼š`/faq`
   â€¢ å¸®åŠ©å‘½ä»¤ï¼š`/help`

**2. ç¾¤ç»„æ±‚åŠ©**
   â€¢ åœ¨å®˜æ–¹ç¾¤ç»„æé—®
   â€¢ å…¶ä»–ç”¨æˆ·ä¼šå¸®åŠ©ä½ 
   â€¢ ç®¡ç†å‘˜ä¼šè§£ç­”

**3. è”ç³»ç®¡ç†å‘˜**
   â€¢ åœ¨ç¾¤ç»„ @ç®¡ç†å‘˜
   â€¢ æˆ–å‘é€ç§ä¿¡
   â€¢ è¯´æ˜ä½ çš„é—®é¢˜

**æŠ¥å‘Šé—®é¢˜æ—¶è¯·æä¾›ï¼š**
â€¢ Telegram ID
â€¢ é—®é¢˜æè¿°
â€¢ æˆªå›¾ï¼ˆå¦‚æœ‰ï¼‰
â€¢ å¤ç°æ­¥éª¤

**å“åº”æ—¶é—´ï¼š**
â€¢ å·¥ä½œæ—¶é—´ï¼š1-2 å°æ—¶
â€¢ éå·¥ä½œæ—¶é—´ï¼šå¯èƒ½è¾ƒæ…¢

æˆ‘ä»¬ä¼šå°½å¿«å¸®åŠ©ä½ ï¼
"""
        back_button = ikb([[('â†©ï¸ è¿”å›å¸®åŠ©', 'help_back'), ('âŒ å…³é—­', 'closeit')]])
        await call.message.edit(contact_text, reply_markup=back_button)

    elif action == 'help_back':
        # è¿”å›ä¸»å¸®åŠ©
        await help_command(_, call.message)

    elif action == 'faq_full':
        # æ˜¾ç¤ºå®Œæ•´ FAQï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
        full_faq_text = """
ğŸ“š **å®Œæ•´ FAQ æ–‡æ¡£**

å®Œæ•´çš„å¸¸è§é—®é¢˜è§£ç­”æ–‡æ¡£åŒ…å« 25+ ä¸ªé—®é¢˜çš„è¯¦ç»†è§£ç­”ã€‚

**ä¸»è¦ç« èŠ‚ï¼š**
â€¢ ğŸ‘¤ è´¦æˆ·ç›¸å…³ï¼ˆQ1-Q5ï¼‰
â€¢ ğŸ“º ä½¿ç”¨ç›¸å…³ï¼ˆQ6-Q10ï¼‰
â€¢ ğŸŸï¸ ç»­æœŸç›¸å…³ï¼ˆQ11-Q15ï¼‰
â€¢ ğŸ”§ æŠ€æœ¯é—®é¢˜ï¼ˆQ16-Q20ï¼‰
â€¢ â“ å…¶ä»–é—®é¢˜ï¼ˆQ21-Q25ï¼‰

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œå®Œæ•´æ–‡æ¡£è¯·ï¼š
â€¢ æŸ¥çœ‹ç¾¤ç»„ç½®é¡¶æ¶ˆæ¯
â€¢ è®¿é—®æ–‡æ¡£ç½‘ç«™ï¼ˆå¦‚æœ‰ï¼‰
â€¢ è”ç³»ç®¡ç†å‘˜è·å–

æˆ–ç»§ç»­ä½¿ç”¨ `/faq` æŸ¥çœ‹å¸¸è§é—®é¢˜ã€‚
"""
        back_button = ikb([[('â†©ï¸ è¿”å› FAQ', 'help_faq'), ('âŒ å…³é—­', 'closeit')]])
        await call.message.edit(full_faq_text, reply_markup=back_button)
