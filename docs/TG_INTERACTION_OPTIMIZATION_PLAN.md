# EmbyBot Telegram äº¤äº’ä¸å±•ç¤ºä¼˜åŒ–æ–¹æ¡ˆ

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-24
> **é¡¹ç›®**: EmbyBot
> **ç›®æ ‡**: å…¨é¢æå‡ç”¨æˆ·ä½“éªŒå’Œä»£ç å¯ç»´æŠ¤æ€§

---

## ğŸ“‹ ç›®å½•

- [ä¸€ã€ç°çŠ¶åˆ†æ](#ä¸€ç°çŠ¶åˆ†æ)
- [äºŒã€ä¼˜åŒ–ç›®æ ‡](#äºŒä¼˜åŒ–ç›®æ ‡)
- [ä¸‰ã€æ€»ä½“æ¶æ„è®¾è®¡](#ä¸‰æ€»ä½“æ¶æ„è®¾è®¡)
- [å››ã€è¯¦ç»†å®æ–½æ–¹æ¡ˆ](#å››è¯¦ç»†å®æ–½æ–¹æ¡ˆ)
  - [é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„å»ºè®¾](#é˜¶æ®µä¸€åŸºç¡€æ¶æ„å»ºè®¾)
  - [é˜¶æ®µäºŒï¼šæ ¸å¿ƒæ¨¡å—ä¼˜åŒ–](#é˜¶æ®µäºŒæ ¸å¿ƒæ¨¡å—ä¼˜åŒ–)
  - [é˜¶æ®µä¸‰ï¼šç”¨æˆ·ä½“éªŒæå‡](#é˜¶æ®µä¸‰ç”¨æˆ·ä½“éªŒæå‡)
  - [é˜¶æ®µå››ï¼šé«˜çº§åŠŸèƒ½å®Œå–„](#é˜¶æ®µå››é«˜çº§åŠŸèƒ½å®Œå–„)
- [äº”ã€å®æ–½è®¡åˆ’](#äº”å®æ–½è®¡åˆ’)
- [å…­ã€è´¨é‡ä¿è¯](#å…­è´¨é‡ä¿è¯)
- [ä¸ƒã€é¢„æœŸæ•ˆæœ](#ä¸ƒé¢„æœŸæ•ˆæœ)
- [å…«ã€é£é™©è¯„ä¼°](#å…«é£é™©è¯„ä¼°)
- [é™„å½•](#é™„å½•)

---

## ä¸€ã€ç°çŠ¶åˆ†æ

### 1.1 ä»£ç ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| å‘½ä»¤å¤„ç†å™¨ | 24 ä¸ª | `bot/modules/commands/` |
| å›è°ƒå¤„ç†å™¨ | 6 ä¸ª | `bot/modules/callback/` |
| ç”¨æˆ·é¢æ¿ | 8 ä¸ª | `bot/modules/panel/` |
| æ¶ˆæ¯å‘é€ç‚¹ | 445 å¤„ | éå¸ƒå„ä¸ªæ¨¡å— |
| Emoji ä½¿ç”¨ | 216 å¤„ | é£æ ¼ä¸ç»Ÿä¸€ |

### 1.2 ä¸»è¦é—®é¢˜

#### ğŸ”´ é«˜ä¼˜å…ˆçº§é—®é¢˜

1. **æ¶ˆæ¯æ–‡æœ¬ç®¡ç†æ··ä¹±**
   - æ‰€æœ‰æ¶ˆæ¯æ–‡æœ¬ç¡¬ç¼–ç åœ¨å„ä¸ªæ–‡ä»¶ä¸­
   - ç›¸åŒæç¤ºåœ¨ä¸åŒæ–‡ä»¶ä¸­é‡å¤å®šä¹‰
   - æ ¼å¼å’Œé£æ ¼ä¸ç»Ÿä¸€
   - éš¾ä»¥æ‰¹é‡ä¿®æ”¹å’Œç»´æŠ¤

2. **é”™è¯¯æç¤ºä¸å¤Ÿå‹å¥½**
   - é”™è¯¯æ¶ˆæ¯è¿‡äºç®€å•ï¼Œç¼ºå°‘è¯¦ç»†è¯´æ˜
   - æ²¡æœ‰æä¾›è§£å†³å»ºè®®å’Œä¸‹ä¸€æ­¥æ“ä½œ
   - ç”¨æˆ·éš¾ä»¥ç†è§£é—®é¢˜åŸå› 

3. **æŒ‰é’®è®¾è®¡ä¸è§„èŒƒ**
   - Emoji ä½¿ç”¨æ··ä¹±ï¼ˆ216 å¤„ï¼‰
   - æŒ‰é’®æ’åˆ—æ²¡æœ‰ç»Ÿä¸€è§„èŒƒ
   - æ–‡æœ¬é•¿åº¦ä¸ä¸€è‡´
   - åŠŸèƒ½åˆ†ç»„ä¸æ˜ç¡®

#### ğŸŸ  ä¸­ä¼˜å…ˆçº§é—®é¢˜

4. **ç”¨æˆ·å¼•å¯¼ä¸è¶³**
   - æ–°ç”¨æˆ·ç¼ºå°‘ä½¿ç”¨æŒ‡å¼•
   - å‘½ä»¤æ ¼å¼æç¤ºä¸æ¸…æ™°
   - æ²¡æœ‰å¸®åŠ©æ–‡æ¡£å’Œ FAQ

5. **çŠ¶æ€åé¦ˆç¼ºå¤±**
   - é•¿æ—¶é—´æ“ä½œç¼ºå°‘è¿›åº¦æç¤º
   - ç”¨æˆ·ä¸çŸ¥é“æ“ä½œæ˜¯å¦åœ¨æ‰§è¡Œ
   - æˆåŠŸ/å¤±è´¥çŠ¶æ€ä¸æ˜æ˜¾

6. **ä¿¡æ¯å±•ç¤ºå¯†åº¦å¤§**
   - å•æ¡æ¶ˆæ¯ä¿¡æ¯è¿‡å¤š
   - ç¼ºå°‘åˆç†åˆ†æ®µå’Œæ ¼å¼åŒ–
   - å…³é”®ä¿¡æ¯ä¸çªå‡º

#### ğŸŸ¡ ä½ä¼˜å…ˆçº§é—®é¢˜

7. **ä»£ç é‡å¤**
   - æ¶ˆæ¯æ ¼å¼åŒ–é€»è¾‘é‡å¤
   - éªŒè¯é€»è¾‘åˆ†æ•£
   - ç¼ºå°‘ç»Ÿä¸€çš„å·¥å…·å‡½æ•°

8. **äº¤äº’æµç¨‹å¤æ‚**
   - éƒ¨åˆ†æ“ä½œéœ€è¦å¤šæ¬¡äº¤äº’
   - ä¼šè¯è¶…æ—¶æ—¶é—´çŸ­ï¼ˆ120ç§’ï¼‰
   - ç¼ºå°‘å¿«æ·æ“ä½œ

### 1.3 ä¼˜ç§€å®è·µï¼ˆä¿æŒï¼‰

âœ… ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼
âœ… å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•
âœ… ä½¿ç”¨ Markdown æ ¼å¼åŒ–
âœ… åŠŸèƒ½æ¨¡å—åŒ–è®¾è®¡

---

## äºŒã€ä¼˜åŒ–ç›®æ ‡

### 2.1 æ ¸å¿ƒç›®æ ‡

1. **æå‡ç”¨æˆ·ä½“éªŒ**
   - æ¸…æ™°å‹å¥½çš„æç¤ºä¿¡æ¯
   - ç›´è§‚çš„ç•Œé¢å¸ƒå±€
   - åŠæ—¶çš„çŠ¶æ€åé¦ˆ
   - å®Œå–„çš„å¸®åŠ©ç³»ç»Ÿ

2. **æé«˜ä»£ç è´¨é‡**
   - ç»Ÿä¸€çš„æ¶ˆæ¯ç®¡ç†
   - å¯ç»´æŠ¤çš„ä»£ç ç»“æ„
   - å¯å¤ç”¨çš„å·¥å…·å‡½æ•°
   - è§„èŒƒçš„ä»£ç é£æ ¼

3. **å¢å¼ºå¯æ‰©å±•æ€§**
   - æ˜“äºæ·»åŠ æ–°åŠŸèƒ½
   - æ”¯æŒå¤šè¯­è¨€æ‰©å±•
   - ä¾¿äºä¸»é¢˜å®šåˆ¶
   - çµæ´»çš„é…ç½®ç³»ç»Ÿ

### 2.2 é‡åŒ–æŒ‡æ ‡

| æŒ‡æ ‡ | ç°çŠ¶ | ç›®æ ‡ | æå‡ |
|------|------|------|------|
| æ¶ˆæ¯æ¨¡æ¿å¤ç”¨ç‡ | 0% | 80% | +80% |
| é”™è¯¯æç¤ºå®Œæ•´æ€§ | 30% | 95% | +65% |
| æŒ‰é’®é£æ ¼ç»Ÿä¸€åº¦ | 40% | 100% | +60% |
| ç”¨æˆ·æ“ä½œæˆåŠŸç‡ | 75% | 90% | +15% |
| ä»£ç å¯ç»´æŠ¤æ€§ | ä¸­ | é«˜ | - |

---

## ä¸‰ã€æ€»ä½“æ¶æ„è®¾è®¡

### 3.1 æ–°å¢æ–‡ä»¶ç»“æ„

```
bot/
â”œâ”€â”€ constants/              # æ–°å¢ï¼šå¸¸é‡å’Œé…ç½®
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ messages.py        # æ¶ˆæ¯æ¨¡æ¿
â”‚   â”œâ”€â”€ buttons.py         # æŒ‰é’®é…ç½®
â”‚   â”œâ”€â”€ emojis.py          # Emoji è§„èŒƒ
â”‚   â””â”€â”€ formats.py         # æ ¼å¼è§„èŒƒ
â”‚
â”œâ”€â”€ func_helper/
â”‚   â”œâ”€â”€ message_formatter.py   # æ–°å¢ï¼šæ¶ˆæ¯æ ¼å¼åŒ–
â”‚   â”œâ”€â”€ validators.py          # æ–°å¢ï¼šè¾“å…¥éªŒè¯
â”‚   â”œâ”€â”€ progress_tracker.py    # æ–°å¢ï¼šè¿›åº¦è·Ÿè¸ª
â”‚   â””â”€â”€ template_engine.py     # æ–°å¢ï¼šæ¨¡æ¿å¼•æ“
â”‚
â””â”€â”€ docs/                  # æ–°å¢ï¼šæ–‡æ¡£ç›®å½•
    â”œâ”€â”€ USER_GUIDE.md      # ç”¨æˆ·æŒ‡å—
    â”œâ”€â”€ FAQ.md             # å¸¸è§é—®é¢˜
    â””â”€â”€ COMMANDS.md        # å‘½ä»¤æ‰‹å†Œ
```

### 3.2 è®¾è®¡åŸåˆ™

#### ğŸ“Œ æ¶ˆæ¯è®¾è®¡åŸåˆ™

1. **æ¸…æ™°æ€§åŸåˆ™**
   - ä½¿ç”¨ç®€å•ç›´ç™½çš„è¯­è¨€
   - é¿å…ä¸“ä¸šæœ¯è¯­å’Œç¼©å†™
   - å…³é”®ä¿¡æ¯çªå‡ºæ˜¾ç¤º

2. **å®Œæ•´æ€§åŸåˆ™**
   - è¯´æ˜å½“å‰çŠ¶æ€
   - è§£é‡Šé—®é¢˜åŸå› 
   - æä¾›è§£å†³æ–¹æ¡ˆ

3. **ä¸€è‡´æ€§åŸåˆ™**
   - ç»Ÿä¸€çš„æœ¯è¯­ä½¿ç”¨
   - ç»Ÿä¸€çš„æ ¼å¼é£æ ¼
   - ç»Ÿä¸€çš„ Emoji è§„èŒƒ

4. **å‹å¥½æ€§åŸåˆ™**
   - ç§¯ææ­£é¢çš„è¯­æ°”
   - ç¤¼è²Œçš„è¡¨è¾¾æ–¹å¼
   - é€‚åº¦çš„æƒ…æ„ŸåŒ–è®¾è®¡

#### ğŸ“Œ æŒ‰é’®è®¾è®¡åŸåˆ™

1. **åŠŸèƒ½åˆ†ç»„**
   - ç›¸å…³åŠŸèƒ½æ”¾åœ¨åŒä¸€è¡Œ
   - ä¸»è¦åŠŸèƒ½æ”¾åœ¨ä¸Šæ–¹
   - è¿”å›/å–æ¶ˆæ”¾åœ¨ä¸‹æ–¹

2. **æ–‡æœ¬è§„èŒƒ**
   - ä¸»æŒ‰é’®ï¼š4-8 ä¸ªå­—ç¬¦
   - æ¬¡æŒ‰é’®ï¼š2-6 ä¸ªå­—ç¬¦
   - ä½¿ç”¨åŠ¨è¯å¼€å¤´

3. **Emoji è§„èŒƒ**
   - æ¯ä¸ªæŒ‰é’®æœ€å¤š 1 ä¸ª Emoji
   - ä½¿ç”¨ç»Ÿä¸€çš„å›¾æ ‡è¯­ä¹‰
   - ä¿æŒè§†è§‰å¹³è¡¡

#### ğŸ“Œ äº¤äº’è®¾è®¡åŸåˆ™

1. **æœ€å°åŒ–æ­¥éª¤**
   - å‡å°‘ç”¨æˆ·è¾“å…¥æ¬¡æ•°
   - æä¾›å¿«æ·é€‰é¡¹
   - æ”¯æŒæ‰¹é‡æ“ä½œ

2. **å³æ—¶åé¦ˆ**
   - æ“ä½œåç«‹å³å“åº”
   - æ˜¾ç¤ºå¤„ç†è¿›åº¦
   - æ˜ç¡®æˆåŠŸ/å¤±è´¥

3. **å®¹é”™æ€§**
   - æä¾›æ’¤é”€åŠŸèƒ½
   - æ“ä½œå‰ç¡®è®¤
   - å‹å¥½çš„é”™è¯¯æ¢å¤

---

## å››ã€è¯¦ç»†å®æ–½æ–¹æ¡ˆ

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„å»ºè®¾

**ç›®æ ‡**: å»ºç«‹ç»Ÿä¸€çš„æ¶ˆæ¯ç®¡ç†å’Œå·¥å…·å‡½æ•°ä½“ç³»
**å·¥æœŸ**: 5 ä¸ªå·¥ä½œæ—¥
**ä¼˜å…ˆçº§**: â­â­â­â­â­

---

#### ä»»åŠ¡ 1.1ï¼šåˆ›å»ºæ¶ˆæ¯æ¨¡æ¿ç³»ç»Ÿ

**æ–‡ä»¶**: `bot/constants/messages.py`

```python
"""
æ¶ˆæ¯æ¨¡æ¿é›†ä¸­ç®¡ç†
ä½¿ç”¨æ–¹æ³•ï¼šfrom bot.constants.messages import Messages
"""

class Messages:
    """æ‰€æœ‰æ¶ˆæ¯æ¨¡æ¿çš„é›†ä¸­ç®¡ç†ç±»"""

    # ==================== ç³»ç»Ÿæ¶ˆæ¯ ====================

    SYSTEM_WELCOME = """
âœ¨ **æ¬¢è¿ä½¿ç”¨ EmbyBot**

ğŸ‘‹ ä½ å¥½ï¼Œ{first_name}ï¼

**å¿«é€Ÿå¼€å§‹ï¼š**
1ï¸âƒ£ ç‚¹å‡»ä¸‹æ–¹ **åˆ›å»ºè´¦æˆ·** æŒ‰é’®
2ï¸âƒ£ æŒ‰ç…§æç¤ºè¾“å…¥ç”¨æˆ·åå’Œå®‰å…¨ç 
3ï¸âƒ£ è·å–ä½ çš„ Emby è´¦æˆ·ä¿¡æ¯

**å¸¸ç”¨åŠŸèƒ½ï¼š**
ğŸ“º è§‚çœ‹åª’ä½“ - ä½¿ç”¨ Emby å®¢æˆ·ç«¯ç™»å½•
ğŸŸï¸ ç»­æœŸè´¦æˆ· - ä½¿ç”¨ç»­æœŸç å»¶é•¿æ—¶é—´
ğŸ”‘ é‡ç½®å¯†ç  - å¿˜è®°å¯†ç å¯éšæ—¶é‡ç½®
ğŸ’¬ æŸ¥çœ‹å¸®åŠ© - ä½¿ç”¨ /help å‘½ä»¤

ğŸ’¡ æç¤ºï¼šç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹ä½¿ç”¨ï¼
"""

    SYSTEM_REGISTERED = """
ğŸ‰ **æ³¨å†ŒæˆåŠŸï¼**

æ•°æ®åº“å½•å…¥å®Œæˆï¼Œä½ ç°åœ¨å¯ä»¥ï¼š
â€¢ åˆ›å»º Emby è´¦æˆ·
â€¢ å…‘æ¢æ³¨å†Œç 
â€¢ æŸ¥çœ‹è´¦æˆ·ä¿¡æ¯

ç‚¹å‡» /start å¬å”¤ä¸»é¢æ¿
"""

    SYSTEM_MAINTENANCE = """
ğŸ”§ **ç³»ç»Ÿç»´æŠ¤ä¸­**

Emby æœåŠ¡å™¨æ­£åœ¨ç»´æŠ¤ï¼Œæš‚æ—¶æ— æ³•å¤„ç†è¯·æ±‚ã€‚

â° é¢„è®¡æ¢å¤æ—¶é—´ï¼š{time}
ğŸ“¢ è·å–æœ€æ–°æ¶ˆæ¯ï¼š{channel}

æ„Ÿè°¢ä½ çš„è€å¿ƒç­‰å¾…ï¼
"""

    # ==================== é”™è¯¯æ¶ˆæ¯ ====================

    ERROR_NOT_IN_DATABASE = """
âš ï¸ **æœªæ‰¾åˆ°ä½ çš„è®°å½•**

**å¯èƒ½åŸå› ï¼š**
â€¢ é¦–æ¬¡ä½¿ç”¨æœ¬æœºå™¨äºº
â€¢ æ•°æ®åº“è®°å½•å·²è¢«æ¸…ç†

**è§£å†³æ–¹æ³•ï¼š**
ç‚¹å‡» /start é‡æ–°æ³¨å†Œåˆ°æ•°æ®åº“

å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»ç®¡ç†å‘˜
"""

    ERROR_NOT_IN_GROUP = """
ğŸ’¢ **è¯·å…ˆåŠ å…¥ç¾¤ç»„**

ä½¿ç”¨æœ¬æœºå™¨äººéœ€è¦åŠ å…¥ä»¥ä¸‹ç¾¤ç»„/é¢‘é“ï¼š
{group_links}

**æ“ä½œæ­¥éª¤ï¼š**
1ï¸âƒ£ ç‚¹å‡»ä¸Šæ–¹é“¾æ¥åŠ å…¥ç¾¤ç»„
2ï¸âƒ£ åŠ å…¥åè¿”å›æœºå™¨äºº
3ï¸âƒ£ ç‚¹å‡» /start é‡æ–°å¼€å§‹

âš ï¸ **å·²åœ¨ç¾¤ç»„ä»æ”¶åˆ°æ­¤æ¶ˆæ¯ï¼Ÿ**
å¯èƒ½æ˜¯ä½ çš„è´¦æˆ·è¢«é™åˆ¶äº†ï¼Œè¯·è”ç³»ç®¡ç†å‘˜è§£é™¤é™åˆ¶ã€‚
"""

    ERROR_USER_NOT_FOUND = """
âŒ **æœªæ‰¾åˆ°ç”¨æˆ·**

æŸ¥è¯¢å¯¹è±¡ï¼š`{user_id}`

**å¯èƒ½åŸå› ï¼š**
â€¢ ç”¨æˆ·å°šæœªæ³¨å†Œ Emby è´¦æˆ·
â€¢ ç”¨æˆ· Emby è´¦æˆ·å·²è¢«åˆ é™¤
â€¢ è¾“å…¥çš„ç”¨æˆ·IDæˆ–ç”¨æˆ·åæœ‰è¯¯

**å»ºè®®æ“ä½œï¼š**
âœ… ç¡®è®¤ç”¨æˆ·IDæ˜¯å¦æ­£ç¡®
âœ… æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²åˆ›å»ºè´¦æˆ·
âœ… å°è¯•ä½¿ç”¨ç”¨æˆ·åæœç´¢
âœ… è”ç³»ç®¡ç†å‘˜ååŠ©å¤„ç†
"""

    ERROR_EMBY_SERVER_UNREACHABLE = """
ğŸ”´ **Emby æœåŠ¡å™¨è¿æ¥å¤±è´¥**

æ— æ³•è¿æ¥åˆ° Emby æœåŠ¡å™¨ï¼Œæ“ä½œå·²å–æ¶ˆã€‚

**å¯èƒ½åŸå› ï¼š**
â€¢ æœåŠ¡å™¨æ­£åœ¨ç»´æŠ¤
â€¢ ç½‘ç»œè¿æ¥é—®é¢˜
â€¢ æœåŠ¡å™¨é…ç½®é”™è¯¯

**å»ºè®®æ“ä½œï¼š**
â° ç¨åå†è¯•
ğŸ“¢ å…³æ³¨å…¬å‘Šé¢‘é“è·å–æœ€æ–°çŠ¶æ€
ğŸ’¬ è”ç³»ç®¡ç†å‘˜æŠ¥å‘Šé—®é¢˜

ä¼šè¯å·²ç»“æŸï¼Œè¯·ç¨åé‡è¯•ã€‚
"""

    ERROR_INVALID_FORMAT = """
âš ï¸ **è¾“å…¥æ ¼å¼é”™è¯¯**

ä½ è¾“å…¥çš„å†…å®¹ï¼š`{input}`

**æ­£ç¡®æ ¼å¼ï¼š**
{correct_format}

**ç¤ºä¾‹ï¼š**
{example}

è¯·é‡æ–°è¾“å…¥ï¼Œæˆ–ç‚¹å‡» /cancel å–æ¶ˆæ“ä½œã€‚
"""

    ERROR_PERMISSION_DENIED = """
ğŸš« **æƒé™ä¸è¶³**

æ­¤æ“ä½œéœ€è¦ {required_permission} æƒé™ã€‚

å½“å‰æƒé™ï¼š{current_permission}

å¦‚éœ€å¸®åŠ©ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚
"""

    # ==================== è´¦æˆ·ç®¡ç† ====================

    ACCOUNT_CREATE_START = """
ğŸ¨ **åˆ›å»º Emby è´¦æˆ·**

è¯·åœ¨ **{timeout}ç§’** å†…è¾“å…¥ï¼š

**æ ¼å¼ï¼š** `ç”¨æˆ·å å®‰å…¨ç `
**ç¤ºä¾‹ï¼š** `è‹è‹ 1234`

**è§„åˆ™è¯´æ˜ï¼š**
â€¢ **ç”¨æˆ·å**ï¼šæ”¯æŒä¸­æ–‡/è‹±æ–‡/Emojiï¼Œä¸æ”¯æŒç‰¹æ®Šå­—ç¬¦ï¼ˆ@#$%ç­‰ï¼‰
â€¢ **å®‰å…¨ç **ï¼š4-6ä½æ•°å­—ï¼Œç”¨äºæ•æ„Ÿæ“ä½œéªŒè¯

ğŸ’¡ æç¤ºï¼šå®‰å…¨ç è¯·è®¾ç½®ä¸ºå®¹æ˜“è®°ä½çš„æ•°å­—

é€€å‡ºè¯·ç‚¹å‡» /cancel
"""

    ACCOUNT_CREATE_PROCESSING = """
ğŸ”„ **æ­£åœ¨åˆ›å»ºè´¦æˆ·...**

âœ… [1/4] éªŒè¯è¾“å…¥ä¿¡æ¯
â³ [2/4] è¿æ¥ Emby æœåŠ¡å™¨
â³ [3/4] åˆ›å»ºç”¨æˆ·è´¦æˆ·
â³ [4/4] é…ç½®ç”¨æˆ·æƒé™

è¯·ç¨å€™...
"""

    ACCOUNT_CREATE_SUCCESS = """
ğŸ‰ **è´¦æˆ·åˆ›å»ºæˆåŠŸï¼**

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚  ğŸ“º **è´¦æˆ·ä¿¡æ¯**
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

ğŸ‘¤ **ç”¨æˆ·å**
   `{username}`

ğŸ”‘ **å¯†ç **
   `{password}`

ğŸ“… **åˆ°æœŸæ—¶é—´**
   {expiry}

ğŸŒ **æœåŠ¡å™¨åœ°å€**
   {server_url}

---

**ä¸‹ä¸€æ­¥æ“ä½œï¼š**
1ï¸âƒ£ ä¸‹è½½ Emby å®¢æˆ·ç«¯
2ï¸âƒ£ ä½¿ç”¨ä¸Šè¿°ä¿¡æ¯ç™»å½•
3ï¸âƒ£ å¼€å§‹äº«å—å½±éŸ³æœåŠ¡

ğŸ“± å®¢æˆ·ç«¯ä¸‹è½½ï¼š{client_download_url}
ğŸ’¡ ä½¿ç”¨æ•™ç¨‹ï¼šè¾“å…¥ /help æŸ¥çœ‹

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸ¬
"""

    ACCOUNT_CREATE_FAILED = """
âŒ **è´¦æˆ·åˆ›å»ºå¤±è´¥**

**å¤±è´¥åŸå› ï¼š**
{reason}

**å¯èƒ½çš„é—®é¢˜ï¼š**
{possible_causes}

**å»ºè®®æ“ä½œï¼š**
{suggestions}

ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é‡æ–°å°è¯•ï¼Œæˆ–è”ç³»ç®¡ç†å‘˜ã€‚
"""

    ACCOUNT_DELETE_CONFIRM = """
âš ï¸ **ç¡®è®¤åˆ é™¤è´¦æˆ·**

ä½ å³å°†åˆ é™¤ä»¥ä¸‹è´¦æˆ·ï¼š

ğŸ‘¤ ç”¨æˆ·åï¼š`{username}`
ğŸ†” ç”¨æˆ·IDï¼š`{user_id}`
ğŸ“… åˆ›å»ºæ—¶é—´ï¼š{create_time}

**è­¦å‘Šï¼š**
ğŸ”´ æ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼
ğŸ”´ æ‰€æœ‰æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ï¼
ğŸ”´ æ”¶è—å’Œè§‚çœ‹è®°å½•å°†ä¸¢å¤±ï¼

**ç¡®è®¤åˆ é™¤ï¼Ÿ**
"""

    ACCOUNT_DELETE_SUCCESS = """
âœ… **è´¦æˆ·å·²åˆ é™¤**

ç”¨æˆ·ï¼š{username}
æ“ä½œæ—¶é—´ï¼š{time}

æ•°æ®å·²ä»ç³»ç»Ÿä¸­ç§»é™¤ã€‚

å¦‚éœ€é‡æ–°ä½¿ç”¨ï¼Œè¯·é‡æ–°åˆ›å»ºè´¦æˆ·ã€‚
"""

    ACCOUNT_PASSWORD_RESET = """
ğŸ”‘ **å¯†ç é‡ç½®æˆåŠŸ**

æ–°å¯†ç ï¼š`{new_password}`

**é‡è¦æç¤ºï¼š**
â€¢ è¯·ç«‹å³ä½¿ç”¨æ–°å¯†ç ç™»å½•
â€¢ å»ºè®®åœ¨ Emby å®¢æˆ·ç«¯ä¸­ä¿®æ”¹å¯†ç 
â€¢ ä¿æŠ¤å¥½ä½ çš„è´¦æˆ·ä¿¡æ¯

å¦‚æœªæ“ä½œæ­¤é‡ç½®ï¼Œè¯·ç«‹å³è”ç³»ç®¡ç†å‘˜ï¼
"""

    # ==================== å…‘æ¢ç ç›¸å…³ ====================

    REDEEM_CODE_INVALID = """
â›” **å…‘æ¢ç æ— æ•ˆ**

ä½ è¾“å…¥çš„å…‘æ¢ç ï¼š`{code}`

**å¯èƒ½åŸå› ï¼š**
â€¢ å…‘æ¢ç æ ¼å¼é”™è¯¯
â€¢ å…‘æ¢ç å·²è¢«ä½¿ç”¨
â€¢ å…‘æ¢ç å·²è¿‡æœŸ
â€¢ å…‘æ¢ç ä¸å­˜åœ¨

**å»ºè®®æ“ä½œï¼š**
âœ… æ£€æŸ¥å…‘æ¢ç æ˜¯å¦è¾“å…¥æ­£ç¡®ï¼ˆæ³¨æ„å¤§å°å†™ï¼‰
âœ… ç¡®è®¤å…‘æ¢ç æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…
âœ… è”ç³»æä¾›å…‘æ¢ç çš„äººç¡®è®¤
âœ… è”ç³»ç®¡ç†å‘˜è·å–å¸®åŠ©

éœ€è¦è´­ä¹°å…‘æ¢ç ï¼Ÿç‚¹å‡» /store æŸ¥çœ‹å•†åº—
"""

    REDEEM_CODE_SUCCESS = """
ğŸ‰ **å…‘æ¢æˆåŠŸï¼**

å…‘æ¢ç ï¼š`{code}`
ç±»å‹ï¼š{code_type}

**è·å¾—å¥–åŠ±ï¼š**
{rewards}

**å½“å‰çŠ¶æ€ï¼š**
{status}

æ„Ÿè°¢ä½ çš„æ”¯æŒï¼ç»§ç»­äº«å—æœåŠ¡å§ ğŸ¬
"""

    REDEEM_REGISTER_CLOSED = """
ğŸš« **æ³¨å†Œæš‚æ—¶å…³é—­**

å½“å‰æ— æ³•ä½¿ç”¨æ³¨å†Œç åˆ›å»ºæ–°è´¦æˆ·ã€‚

**å¼€æ”¾æ—¶é—´ï¼š**
{open_time}

**å…¶ä»–æ–¹å¼ï¼š**
â€¢ ä½¿ç”¨ç»­æœŸç å»¶é•¿ç°æœ‰è´¦æˆ·
â€¢ å…³æ³¨å…¬å‘Šé¢‘é“è·å–å¼€æ”¾é€šçŸ¥
â€¢ è”ç³»ç®¡ç†å‘˜äº†è§£è¯¦æƒ…

æ•¬è¯·æœŸå¾…ï¼
"""

    # ==================== ç”¨æˆ·ä¿¡æ¯å±•ç¤º ====================

    USER_INFO_CARD = """
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚  ğŸ‘¤ **ç”¨æˆ·ä¿¡æ¯**
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

ğŸ†” **Telegram ID**
   `{tg_id}`

ğŸ‘¤ **ç”¨æˆ·å**
   [{name}](tg://user?id={tg_id})

ğŸ“Š **è´¦æˆ·çŠ¶æ€**
   {status_badge} {status}

ğŸ’° **æŒæœ‰{coin_name}**
   {coins}

ğŸ“º **Emby è´¦æˆ·**
   {emby_username}

â° **åˆ°æœŸæ—¶é—´**
   {expiry}

ğŸ“… **æ³¨å†Œæ—¶é—´**
   {register_time}
"""

    USER_INFO_DETAIL = """
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚  ğŸ“Š **è¯¦ç»†ä¿¡æ¯**
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®

**åŸºæœ¬ä¿¡æ¯ï¼š**
â€¢ TG IDï¼š`{tg_id}`
â€¢ ç”¨æˆ·åï¼š{name}
â€¢ ç­‰çº§ï¼š{level}

**Emby è´¦æˆ·ï¼š**
â€¢ è´¦æˆ·åï¼š`{emby_name}`
â€¢ åˆ›å»ºæ—¶é—´ï¼š{create_time}
â€¢ åˆ°æœŸæ—¶é—´ï¼š{expiry_time}
â€¢ å‰©ä½™å¤©æ•°ï¼š{days_left} å¤©

**ä½¿ç”¨ç»Ÿè®¡ï¼š**
â€¢ è§‚çœ‹æ¬¡æ•°ï¼š{play_count} æ¬¡
â€¢ æ”¶è—æ•°é‡ï¼š{favorite_count} ä¸ª
â€¢ è®¾å¤‡æ•°é‡ï¼š{device_count} å°

**ç§¯åˆ†ä¿¡æ¯ï¼š**
â€¢ å½“å‰{coin_name}ï¼š{coins}
â€¢ æ€»è·å¾—ï¼š{total_earned}
â€¢ æ€»æ¶ˆè´¹ï¼š{total_spent}
"""

    # ==================== ç®¡ç†å‘˜åŠŸèƒ½ ====================

    ADMIN_USER_MANAGE = """
ğŸ”§ **ç”¨æˆ·ç®¡ç†é¢æ¿**

ç›®æ ‡ç”¨æˆ·ï¼š[{name}](tg://user?id={tg_id})

**è´¦æˆ·ä¿¡æ¯ï¼š**
â€¢ Emby ç”¨æˆ·åï¼š`{emby_name}`
â€¢ è´¦æˆ·çŠ¶æ€ï¼š{status}
â€¢ åˆ°æœŸæ—¶é—´ï¼š{expiry}
â€¢ åˆ›å»ºæ—¶é—´ï¼š{create_time}

**å¯æ‰§è¡Œæ“ä½œï¼š**
è¯·é€‰æ‹©ä¸‹æ–¹æŒ‰é’®è¿›è¡Œæ“ä½œ
"""

    ADMIN_OPERATION_SUCCESS = """
âœ… **æ“ä½œæˆåŠŸ**

æ“ä½œç±»å‹ï¼š{operation}
ç›®æ ‡ç”¨æˆ·ï¼š{target}
æ‰§è¡Œäººï¼š{operator}
æ‰§è¡Œæ—¶é—´ï¼š{time}

{details}
"""

    ADMIN_OPERATION_FAILED = """
âŒ **æ“ä½œå¤±è´¥**

æ“ä½œç±»å‹ï¼š{operation}
ç›®æ ‡ç”¨æˆ·ï¼š{target}
å¤±è´¥åŸå› ï¼š{reason}

{suggestions}
"""

    # ==================== å¸®åŠ©å’ŒæŒ‡å¼• ====================

    HELP_COMMAND_LIST = """
ğŸ“š **å‘½ä»¤åˆ—è¡¨**

**ç”¨æˆ·å‘½ä»¤ï¼š**
/start - å¬å”¤ä¸»é¢æ¿
/help - æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
/me - æŸ¥çœ‹æˆ‘çš„ä¿¡æ¯
/exchange - å…‘æ¢æ³¨å†Œç /ç»­æœŸç 

**å¸¸ç”¨åŠŸèƒ½ï¼š**
â€¢ åˆ›å»ºè´¦æˆ· - é€šè¿‡ä¸»é¢æ¿æ“ä½œ
â€¢ é‡ç½®å¯†ç  - ä¸»é¢æ¿ â†’ é‡ç½®å¯†ç 
â€¢ ç»­æœŸè´¦æˆ· - ä½¿ç”¨ /exchange å…‘æ¢ç»­æœŸç 
â€¢ æŸ¥çœ‹æ”¶è— - ä¸»é¢æ¿ â†’ æˆ‘çš„æ”¶è—

**éœ€è¦å¸®åŠ©ï¼Ÿ**
ğŸ“– è¯¦ç»†æ•™ç¨‹ï¼š/guide
â“ å¸¸è§é—®é¢˜ï¼š/faq
ğŸ’¬ è”ç³»ç®¡ç†å‘˜ï¼š{admin_contact}
"""

    HELP_FAQ = """
â“ **å¸¸è§é—®é¢˜è§£ç­”**

**Q1: å¦‚ä½•åˆ›å»º Emby è´¦æˆ·ï¼Ÿ**
A: ç‚¹å‡» /start å¬å”¤é¢æ¿ï¼Œé€‰æ‹©"åˆ›å»ºè´¦æˆ·"ï¼ŒæŒ‰æç¤ºè¾“å…¥ç”¨æˆ·åå’Œå®‰å…¨ç å³å¯ã€‚

**Q2: å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ**
A: åœ¨ä¸»é¢æ¿ä¸­é€‰æ‹©"é‡ç½®å¯†ç "ï¼Œç³»ç»Ÿä¼šç”Ÿæˆæ–°å¯†ç ã€‚

**Q3: å¦‚ä½•ç»­æœŸè´¦æˆ·ï¼Ÿ**
A: ä½¿ç”¨ /exchange å‘½ä»¤å…‘æ¢ç»­æœŸç ï¼Œæˆ–è”ç³»ç®¡ç†å‘˜è´­ä¹°ã€‚

**Q4: è´¦æˆ·åˆ°æœŸåä¼šæ€æ ·ï¼Ÿ**
A: åˆ°æœŸåå°†æ— æ³•ç™»å½•ï¼Œä½†æ•°æ®ä¿ç•™7å¤©ï¼ŒæœŸé—´ç»­æœŸå¯æ¢å¤ã€‚

**Q5: å¯ä»¥åœ¨å¤šä¸ªè®¾å¤‡ä¸Šä½¿ç”¨å—ï¼Ÿ**
A: å¯ä»¥ï¼Œä½†åŒæ—¶æ’­æ”¾è®¾å¤‡æ•°æœ‰é™åˆ¶ï¼ˆé»˜è®¤2å°ï¼‰ã€‚

**Q6: å¦‚ä½•è”ç³»ç®¡ç†å‘˜ï¼Ÿ**
A: {admin_contact}

æ›´å¤šé—®é¢˜ï¼Ÿè®¿é—®å®Œæ•´ FAQ: {faq_url}
"""

    # ==================== é€šçŸ¥æ¶ˆæ¯ ====================

    NOTIFICATION_EXPIRY_WARNING = """
â° **åˆ°æœŸæé†’**

ä½ çš„ Emby è´¦æˆ·å³å°†åˆ°æœŸï¼š

ğŸ“º è´¦æˆ·åï¼š`{username}`
â±ï¸ å‰©ä½™æ—¶é—´ï¼š{days_left} å¤©
ğŸ“… åˆ°æœŸæ—¥æœŸï¼š{expiry_date}

**ç»­æœŸæ–¹å¼ï¼š**
1ï¸âƒ£ ä½¿ç”¨ç»­æœŸç ï¼š/exchange
2ï¸âƒ£ è´­ä¹°ç»­æœŸç ï¼š/store
3ï¸âƒ£ è”ç³»ç®¡ç†å‘˜ï¼š{admin_contact}

è¯·åŠæ—¶ç»­æœŸï¼Œé¿å…æœåŠ¡ä¸­æ–­ï¼
"""

    NOTIFICATION_EXPIRY_EXPIRED = """
ğŸ”´ **è´¦æˆ·å·²åˆ°æœŸ**

ä½ çš„ Emby è´¦æˆ·å·²è¿‡æœŸï¼š

ğŸ“º è´¦æˆ·åï¼š`{username}`
ğŸ“… åˆ°æœŸæ—¶é—´ï¼š{expiry_date}

**å½“å‰çŠ¶æ€ï¼š**
â€¢ æ— æ³•ç™»å½• Emby æœåŠ¡å™¨
â€¢ æ•°æ®ä¿ç•™ 7 å¤©
â€¢ 7 å¤©å†…ç»­æœŸå¯æ¢å¤

**ç«‹å³ç»­æœŸï¼š**
ä½¿ç”¨ /exchange å…‘æ¢ç»­æœŸç 

éœ€è¦å¸®åŠ©ï¼Ÿè”ç³»ç®¡ç†å‘˜ï¼š{admin_contact}
"""

    NOTIFICATION_PASSWORD_CHANGED = """
ğŸ”” **å¯†ç å˜æ›´é€šçŸ¥**

ä½ çš„ Emby è´¦æˆ·å¯†ç å·²è¢«é‡ç½®ï¼š

ğŸ“º è´¦æˆ·åï¼š`{username}`
ğŸ”‘ æ–°å¯†ç ï¼š`{new_password}`
â° æ“ä½œæ—¶é—´ï¼š{time}

**å¦‚æœä¸æ˜¯ä½ çš„æ“ä½œï¼š**
ğŸš¨ è¯·ç«‹å³è”ç³»ç®¡ç†å‘˜ï¼
ğŸ” å»ºè®®ç™»å½•åç«‹å³ä¿®æ”¹å¯†ç 

å®‰å…¨æç¤ºï¼šä¸è¦ä¸ä»–äººåˆ†äº«ä½ çš„å¯†ç 
"""

    # ==================== è¿›åº¦æç¤º ====================

    PROGRESS_TEMPLATE = """
{icon} **{title}**

{steps}

{message}
"""

    # ==================== æ“ä½œç¡®è®¤ ====================

    CONFIRM_DANGEROUS_OPERATION = """
âš ï¸ **å±é™©æ“ä½œç¡®è®¤**

ä½ å³å°†æ‰§è¡Œï¼š**{operation}**

**å½±å“èŒƒå›´ï¼š**
{scope}

**åæœï¼š**
{consequences}

**æ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼**

ç¡®è®¤ç»§ç»­å—ï¼Ÿ
"""

    # ==================== ç»Ÿè®¡å’Œæ’è¡Œ ====================

    RANK_HEADER = """
ğŸ† **{rank_type}æ’è¡Œæ¦œ**

ç»Ÿè®¡æ—¶é—´ï¼š{period}
æ›´æ–°æ—¶é—´ï¼š{update_time}

{description}

---
"""

    RANK_USER_ITEM = """
{rank}. [{name}](tg://user?id={tg_id})
   ğŸ“Š {metric}ï¼š{value}
   {extra_info}
"""

    # ==================== å®¡è®¡æŠ¥å‘Š ====================

    AUDIT_REPORT_HEADER = """
ğŸ“Š **å®¡è®¡æŠ¥å‘Š**

ğŸ” å®¡è®¡å¯¹è±¡ï¼š{target}
ğŸ“… æ—¶é—´èŒƒå›´ï¼š{time_range}
ğŸ‘¤ æ‰§è¡Œäººï¼š{operator}

---

**ç»Ÿè®¡æ‘˜è¦ï¼š**
{summary}

**è¯¦ç»†ç»“æœï¼š**
"""

    AUDIT_IP_REPORT = """
ğŸ“Š **IP å®¡è®¡æŠ¥å‘Š**

**ğŸŒ IP åœ°å€ï¼š** `{ip_address}`
**ğŸ“… æŸ¥è¯¢èŒƒå›´ï¼š** {time_range}
**ğŸ‘¥ ä½¿ç”¨ç”¨æˆ·ï¼š** {user_count} ä¸ª

**ç”¨æˆ·åˆ—è¡¨ï¼š**
{user_list}

**é£é™©è¯„ä¼°ï¼š**
{risk_assessment}

**å»ºè®®æ“ä½œï¼š**
{suggestions}
"""


class ErrorMessages:
    """é”™è¯¯æ¶ˆæ¯çš„è¯¦ç»†å®šä¹‰"""

    @staticmethod
    def create_failed(reason: str) -> str:
        """åˆ›å»ºå¤±è´¥çš„è¯¦ç»†æ¶ˆæ¯"""
        reasons_map = {
            "username_exists": {
                "title": "ç”¨æˆ·åå·²å­˜åœ¨",
                "causes": [
                    "è¯¥ç”¨æˆ·åå·²è¢«å…¶ä»–äººæ³¨å†Œ",
                    "ä½ ä¹‹å‰åˆ›å»ºè¿‡åŒåè´¦æˆ·"
                ],
                "suggestions": [
                    "âœ… æ›´æ¢ä¸€ä¸ªæ–°çš„ç”¨æˆ·å",
                    "âœ… åœ¨ç”¨æˆ·åååŠ æ•°å­—ï¼ˆå¦‚ï¼šè‹è‹2ï¼‰",
                    "âœ… å¦‚æœæ˜¯ä½ çš„æ—§è´¦æˆ·ï¼Œè”ç³»ç®¡ç†å‘˜æ‰¾å›"
                ]
            },
            "invalid_username": {
                "title": "ç”¨æˆ·åæ ¼å¼é”™è¯¯",
                "causes": [
                    "ç”¨æˆ·ååŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ @#$%^&*ï¼‰",
                    "ç”¨æˆ·åé•¿åº¦ä¸ç¬¦åˆè¦æ±‚"
                ],
                "suggestions": [
                    "âœ… åªä½¿ç”¨ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—å’Œä¸‹åˆ’çº¿",
                    "âœ… é•¿åº¦ä¿æŒåœ¨ 3-20 ä¸ªå­—ç¬¦",
                    "âœ… é¿å…ä½¿ç”¨ç©ºæ ¼å’Œç‰¹æ®Šç¬¦å·"
                ]
            },
            "server_error": {
                "title": "æœåŠ¡å™¨è¿æ¥å¤±è´¥",
                "causes": [
                    "Emby æœåŠ¡å™¨æ— å“åº”",
                    "ç½‘ç»œè¿æ¥é—®é¢˜",
                    "æœåŠ¡å™¨æ­£åœ¨ç»´æŠ¤"
                ],
                "suggestions": [
                    "â° è¯·ç¨åå†è¯•",
                    "ğŸ“¢ å…³æ³¨å…¬å‘Šé¢‘é“äº†è§£æœåŠ¡å™¨çŠ¶æ€",
                    "ğŸ’¬ å¦‚æŒç»­å¤±è´¥ï¼Œè”ç³»ç®¡ç†å‘˜"
                ]
            }
        }

        error_info = reasons_map.get(reason, {
            "title": "æœªçŸ¥é”™è¯¯",
            "causes": ["ç³»ç»Ÿå‡ºç°å¼‚å¸¸"],
            "suggestions": ["ğŸ’¬ è¯·è”ç³»ç®¡ç†å‘˜å¤„ç†"]
        })

        return f"""
âŒ **{error_info['title']}**

**å¯èƒ½åŸå› ï¼š**
{chr(10).join(f'â€¢ {c}' for c in error_info['causes'])}

**å»ºè®®æ“ä½œï¼š**
{chr(10).join(error_info['suggestions'])}

ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é‡æ–°å°è¯•
"""


class SuccessMessages:
    """æˆåŠŸæ¶ˆæ¯çš„æ¨¡æ¿"""

    @staticmethod
    def generic_success(operation: str, details: str = "") -> str:
        """é€šç”¨æˆåŠŸæ¶ˆæ¯"""
        return f"""
âœ… **{operation}æˆåŠŸ**

{details if details else 'æ“ä½œå·²å®Œæˆï¼'}

{chr(10)}ç»§ç»­å…¶ä»–æ“ä½œï¼Œæˆ–ç‚¹å‡» /start è¿”å›ä¸»é¢æ¿ã€‚
"""
```

---

#### ä»»åŠ¡ 1.2ï¼šåˆ›å»º Emoji è§„èŒƒ

**æ–‡ä»¶**: `bot/constants/emojis.py`

```python
"""
Emoji ä½¿ç”¨è§„èŒƒ
ç¡®ä¿æ•´ä¸ªé¡¹ç›®ä¸­ Emoji ä½¿ç”¨çš„ä¸€è‡´æ€§
"""

class Emojis:
    """æ ‡å‡†åŒ–çš„ Emoji å®šä¹‰"""

    # ==================== çŠ¶æ€æŒ‡ç¤º ====================
    SUCCESS = "âœ…"           # æˆåŠŸ
    ERROR = "âŒ"             # é”™è¯¯
    WARNING = "âš ï¸"          # è­¦å‘Š
    INFO = "â„¹ï¸"             # ä¿¡æ¯
    LOADING = "â³"          # åŠ è½½ä¸­
    DONE = "âœ”ï¸"             # å®Œæˆ

    # ==================== ç”¨æˆ·ç›¸å…³ ====================
    USER = "ğŸ‘¤"              # ç”¨æˆ·
    USERS = "ğŸ‘¥"             # å¤šä¸ªç”¨æˆ·
    ADMIN = "ğŸ‘‘"             # ç®¡ç†å‘˜
    VIP = "â­"              # VIP/ç™½åå•
    ROBOT = "ğŸ¤–"            # æœºå™¨äºº

    # ==================== åŠŸèƒ½æ“ä½œ ====================
    PLAY = "â–¶ï¸"             # æ’­æ”¾
    PAUSE = "â¸ï¸"            # æš‚åœ
    STOP = "â¹ï¸"             # åœæ­¢
    REFRESH = "ğŸ”„"          # åˆ·æ–°
    SETTINGS = "âš™ï¸"         # è®¾ç½®
    SEARCH = "ğŸ”"           # æœç´¢
    DELETE = "ğŸ—‘ï¸"          # åˆ é™¤
    EDIT = "âœï¸"             # ç¼–è¾‘
    ADD = "â•"              # æ·»åŠ 
    REMOVE = "â–"           # ç§»é™¤

    # ==================== æ•°æ®ç›¸å…³ ====================
    STATS = "ğŸ“Š"            # ç»Ÿè®¡
    CHART = "ğŸ“ˆ"            # å›¾è¡¨
    DOCUMENT = "ğŸ“„"         # æ–‡æ¡£
    FOLDER = "ğŸ“"           # æ–‡ä»¶å¤¹
    FILE = "ğŸ“ƒ"             # æ–‡ä»¶
    LINK = "ğŸ”—"             # é“¾æ¥

    # ==================== æ—¶é—´ç›¸å…³ ====================
    CALENDAR = "ğŸ“…"         # æ—¥å†
    CLOCK = "ğŸ•"            # æ—¶é’Ÿ
    TIMER = "â°"            # å®šæ—¶å™¨
    HOURGLASS = "â³"        # æ²™æ¼

    # ==================== é€šçŸ¥æé†’ ====================
    BELL = "ğŸ””"             # é€šçŸ¥
    ALERT = "ğŸš¨"            # è­¦æŠ¥
    ANNOUNCEMENT = "ğŸ“¢"     # å…¬å‘Š
    MESSAGE = "ğŸ’¬"          # æ¶ˆæ¯
    MAIL = "ğŸ“§"             # é‚®ä»¶

    # ==================== åª’ä½“ç›¸å…³ ====================
    MOVIE = "ğŸ¬"            # ç”µå½±
    TV = "ğŸ“º"               # ç”µè§†
    MUSIC = "ğŸµ"            # éŸ³ä¹
    PHOTO = "ğŸ–¼ï¸"            # å›¾ç‰‡
    VIDEO = "ğŸ¥"            # è§†é¢‘

    # ==================== è´¢åŠ¡ç›¸å…³ ====================
    COIN = "ğŸ’°"             # é‡‘å¸
    MONEY = "ğŸ’µ"            # è´§å¸
    GIFT = "ğŸ"             # ç¤¼ç‰©
    SHOP = "ğŸª"             # å•†åº—
    TICKET = "ğŸŸï¸"          # ç¥¨åˆ¸

    # ==================== å®‰å…¨ç›¸å…³ ====================
    KEY = "ğŸ”‘"              # å¯†é’¥
    LOCK = "ğŸ”’"             # é”å®š
    UNLOCK = "ğŸ”“"           # è§£é”
    SHIELD = "ğŸ›¡ï¸"          # é˜²æŠ¤
    BAN = "ğŸš«"              # ç¦æ­¢

    # ==================== ç½‘ç»œç›¸å…³ ====================
    GLOBE = "ğŸŒ"            # å…¨çƒ/ç½‘ç»œ
    SIGNAL = "ğŸ“¡"           # ä¿¡å·
    WIFI = "ğŸ“¶"             # WiFi
    SERVER = "ğŸ–¥ï¸"          # æœåŠ¡å™¨
    DATABASE = "ğŸ’¾"         # æ•°æ®åº“

    # ==================== æ–¹å‘å¯¼èˆª ====================
    HOME = "ğŸ "             # ä¸»é¡µ
    BACK = "â†©ï¸"             # è¿”å›
    FORWARD = "â©"          # å‰è¿›
    UP = "â¬†ï¸"              # å‘ä¸Š
    DOWN = "â¬‡ï¸"            # å‘ä¸‹
    LEFT = "â¬…ï¸"            # å‘å·¦
    RIGHT = "â¡ï¸"           # å‘å³

    # ==================== æƒ…æ„Ÿè¡¨è¾¾ ====================
    CELEBRATE = "ğŸ‰"        # åº†ç¥
    PARTY = "ğŸŠ"            # æ´¾å¯¹
    HEART = "â¤ï¸"            # çˆ±å¿ƒ
    STAR = "â­"            # æ˜Ÿæ˜Ÿ
    SPARKLE = "âœ¨"          # é—ªå…‰
    FIRE = "ğŸ”¥"             # ç«ç„°
    THUMBUP = "ğŸ‘"          # ç‚¹èµ
    THUMBDOWN = "ğŸ‘"        # ç‚¹è¸©

    # ==================== ç­‰çº§çŠ¶æ€ ====================
    LEVEL_A = "ğŸŸ¢"          # ç™½åå•ï¼ˆç»¿è‰²ï¼‰
    LEVEL_B = "ğŸ”µ"          # æ­£å¸¸ç”¨æˆ·ï¼ˆè“è‰²ï¼‰
    LEVEL_C = "ğŸ”´"          # ç¦ç”¨ï¼ˆçº¢è‰²ï¼‰
    LEVEL_D = "âšª"          # æœªæ³¨å†Œï¼ˆç™½è‰²ï¼‰

    @staticmethod
    def get_status_emoji(level: str) -> str:
        """æ ¹æ®ç”¨æˆ·ç­‰çº§è·å–çŠ¶æ€ Emoji"""
        status_map = {
            'a': Emojis.LEVEL_A,
            'b': Emojis.LEVEL_B,
            'c': Emojis.LEVEL_C,
            'd': Emojis.LEVEL_D,
        }
        return status_map.get(level, 'â“')

    @staticmethod
    def get_level_text(level: str) -> str:
        """è·å–ç­‰çº§æ–‡æœ¬æè¿°"""
        text_map = {
            'a': 'ç™½åå•',
            'b': 'æ­£å¸¸ç”¨æˆ·',
            'c': 'å·²ç¦ç”¨',
            'd': 'æœªæ³¨å†Œ',
        }
        return text_map.get(level, 'æœªçŸ¥')


class ButtonEmojis:
    """æŒ‰é’®ä¸“ç”¨ Emoji"""

    # ä¸»é¢æ¿æŒ‰é’®
    CREATE_ACCOUNT = "ğŸ¨"    # åˆ›å»ºè´¦æˆ·
    MY_INFO = "ğŸ‘¤"           # æˆ‘çš„ä¿¡æ¯
    MY_FAVORITES = "ğŸ’–"      # æˆ‘çš„æ”¶è—
    MY_DEVICES = "ğŸ’ "        # æˆ‘çš„è®¾å¤‡
    RESET_PASSWORD = "ğŸ”‘"    # é‡ç½®å¯†ç 
    DELETE_ACCOUNT = "ğŸ—‘ï¸"   # åˆ é™¤è´¦æˆ·
    STORE = "ğŸª"             # å•†åº—
    HELP = "â“"              # å¸®åŠ©

    # ç®¡ç†é¢æ¿æŒ‰é’®
    USER_LIST = "ğŸ‘¥"         # ç”¨æˆ·åˆ—è¡¨
    WHITELIST = "ğŸ‘‘"         # ç™½åå•
    CODE_MANAGE = "ğŸŸï¸"      # ç ç®¡ç†
    STATS = "ğŸ“Š"             # ç»Ÿè®¡
    SETTINGS = "âš™ï¸"          # è®¾ç½®

    # æ“ä½œæŒ‰é’®
    CONFIRM = "âœ…"           # ç¡®è®¤
    CANCEL = "âŒ"            # å–æ¶ˆ
    BACK = "â†©ï¸"             # è¿”å›
    CLOSE = "ğŸ”’"             # å…³é—­
    REFRESH = "ğŸ”„"          # åˆ·æ–°

    # åŠŸèƒ½æŒ‰é’®
    SHOW_HIDE = "ğŸ¬"        # æ˜¾ç¤º/éšè—
    QUERY = "ğŸ”"            # æŸ¥è¯¢
    EXPORT = "ğŸ“¤"           # å¯¼å‡º
    IMPORT = "ğŸ“¥"           # å¯¼å…¥
```

---

#### ä»»åŠ¡ 1.3ï¼šåˆ›å»ºæŒ‰é’®é…ç½®è§„èŒƒ

**æ–‡ä»¶**: `bot/constants/buttons.py`

```python
"""
æŒ‰é’®é…ç½®è§„èŒƒ
ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æŒ‰é’®çš„æ–‡æœ¬å’Œæ ·å¼
"""

from bot.constants.emojis import ButtonEmojis as E


class ButtonConfig:
    """æŒ‰é’®é…ç½®ç±»"""

    # ==================== ç”¨æˆ·ä¸»é¢æ¿ ====================

    USER_PANEL = {
        'create_account': f'{E.CREATE_ACCOUNT} åˆ›å»ºè´¦æˆ·',
        'my_info': f'{E.MY_INFO} æˆ‘çš„ä¿¡æ¯',
        'my_favorites': f'{E.MY_FAVORITES} æˆ‘çš„æ”¶è—',
        'my_devices': f'{E.MY_DEVICES} æˆ‘çš„è®¾å¤‡',
        'reset_password': f'{E.RESET_PASSWORD} é‡ç½®å¯†ç ',
        'delete_account': f'{E.DELETE_ACCOUNT} åˆ é™¤è´¦æˆ·',
        'store': f'{E.STORE} å…‘æ¢å•†åº—',
        'help': f'{E.HELP} å¸®åŠ©',
        'show_hide': f'{E.SHOW_HIDE} æ˜¾ç¤º/éšè—',
    }

    # ==================== ç®¡ç†å‘˜é¢æ¿ ====================

    ADMIN_PANEL = {
        'user_list': f'{E.USER_LIST} ç”¨æˆ·åˆ—è¡¨',
        'whitelist': f'ğŸ‘‘ ç™½åå•',
        'normal_users': f'{E.USER_LIST} æ™®é€šç”¨æˆ·',
        'code_manage': f'{E.CODE_MANAGE} æ³¨å†Œ/ç»­æœŸç ',
        'device_list': f'{E.MY_DEVICES} è®¾å¤‡åˆ—è¡¨',
        'stats': f'{E.STATS} ç»Ÿè®¡æ•°æ®',
        'settings': f'{E.SETTINGS} ç³»ç»Ÿè®¾ç½®',
        'register_status': f'â­• æ³¨å†ŒçŠ¶æ€',
        'query_register': f'{E.QUERY} æŸ¥è¯¢æ³¨å†Œ',
        'redeem_settings': f'ğŸ¬ å…‘æ¢è®¾ç½®',
    }

    # ==================== é€šç”¨æ“ä½œæŒ‰é’® ====================

    COMMON = {
        'confirm': f'{E.CONFIRM} ç¡®è®¤',
        'cancel': f'{E.CANCEL} å–æ¶ˆ',
        'back': f'{E.BACK} è¿”å›',
        'close': f'{E.CLOSE} å…³é—­',
        'refresh': f'{E.REFRESH} åˆ·æ–°',
        'home': f'ğŸ  è¿”å›ä¸»é¡µ',
    }

    # ==================== åŠŸèƒ½æ“ä½œæŒ‰é’® ====================

    OPERATIONS = {
        'renew': 'â° ç»­æœŸ',
        'ban': 'ğŸš« å°ç¦',
        'unban': 'âœ… è§£å°',
        'promote': 'â¬†ï¸ æå‡',
        'demote': 'â¬‡ï¸ é™çº§',
        'query': f'{E.QUERY} æŸ¥è¯¢',
        'edit': 'âœï¸ ç¼–è¾‘',
        'delete': f'{E.DELETE_ACCOUNT} åˆ é™¤',
    }

    # ==================== åˆ†é¡µæŒ‰é’® ====================

    PAGINATION = {
        'previous': 'â—€ï¸ ä¸Šä¸€é¡µ',
        'next': 'â–¶ï¸ ä¸‹ä¸€é¡µ',
        'first': 'â®ï¸ é¦–é¡µ',
        'last': 'â­ï¸ æœ«é¡µ',
    }

    @staticmethod
    def get_button_text(category: str, key: str, default: str = None) -> str:
        """è·å–æŒ‰é’®æ–‡æœ¬"""
        config_map = {
            'user': ButtonConfig.USER_PANEL,
            'admin': ButtonConfig.ADMIN_PANEL,
            'common': ButtonConfig.COMMON,
            'operation': ButtonConfig.OPERATIONS,
            'page': ButtonConfig.PAGINATION,
        }
        return config_map.get(category, {}).get(key, default or key)


class ButtonLayouts:
    """æŒ‰é’®å¸ƒå±€æ¨¡æ¿"""

    @staticmethod
    def user_main_panel():
        """ç”¨æˆ·ä¸»é¢æ¿å¸ƒå±€"""
        from bot.func_helper.fix_bottons import ikb
        bc = ButtonConfig

        return ikb([
            # ç¬¬ä¸€è¡Œï¼šæ ¸å¿ƒåŠŸèƒ½
            [(bc.USER_PANEL['my_info'], 'me'),
             (bc.USER_PANEL['my_favorites'], 'my_favorites')],

            # ç¬¬äºŒè¡Œï¼šè´¦æˆ·æ“ä½œ
            [(bc.USER_PANEL['reset_password'], 'reset'),
             (bc.USER_PANEL['my_devices'], 'my_devices')],

            # ç¬¬ä¸‰è¡Œï¼šå…¶ä»–åŠŸèƒ½
            [(bc.USER_PANEL['store'], 'storeall'),
             (bc.USER_PANEL['show_hide'], 'embyblock')],

            # ç¬¬å››è¡Œï¼šå±é™©æ“ä½œ
            [(bc.USER_PANEL['delete_account'], 'delme')],
        ])

    @staticmethod
    def admin_main_panel():
        """ç®¡ç†å‘˜ä¸»é¢æ¿å¸ƒå±€"""
        from bot.func_helper.fix_bottons import ikb
        bc = ButtonConfig

        return ikb([
            # ç¬¬ä¸€è¡Œï¼šæ³¨å†Œç®¡ç†
            [(bc.ADMIN_PANEL['register_status'], 'open-menu'),
             (bc.ADMIN_PANEL['code_manage'], 'cr_link')],

            # ç¬¬äºŒè¡Œï¼šæŸ¥è¯¢åŠŸèƒ½
            [(bc.ADMIN_PANEL['query_register'], 'ch_link'),
             (bc.ADMIN_PANEL['redeem_settings'], 'set_renew')],

            # ç¬¬ä¸‰è¡Œï¼šç”¨æˆ·ç®¡ç†
            [(bc.ADMIN_PANEL['normal_users'], 'normaluser'),
             (bc.ADMIN_PANEL['whitelist'], 'whitelist')],

            # ç¬¬å››è¡Œï¼šè®¾å¤‡ç»Ÿè®¡
            [(bc.ADMIN_PANEL['device_list'], 'user_devices')],

            # ç¬¬äº”è¡Œï¼šè¿”å›
            [(bc.COMMON['back'], 'start_over')],
        ])

    @staticmethod
    def confirm_cancel(confirm_callback: str, cancel_callback: str = 'cancel'):
        """ç¡®è®¤/å–æ¶ˆæŒ‰é’®å¸ƒå±€"""
        from bot.func_helper.fix_bottons import ikb
        bc = ButtonConfig

        return ikb([
            [(bc.COMMON['confirm'], confirm_callback),
             (bc.COMMON['cancel'], cancel_callback)],
        ])
```

---

#### ä»»åŠ¡ 1.4ï¼šåˆ›å»ºæ¶ˆæ¯æ ¼å¼åŒ–å·¥å…·

**æ–‡ä»¶**: `bot/func_helper/message_formatter.py`

```python
"""
æ¶ˆæ¯æ ¼å¼åŒ–å·¥å…·
æä¾›ç»Ÿä¸€çš„æ¶ˆæ¯æ ¼å¼åŒ–åŠŸèƒ½
"""

from datetime import datetime, timedelta
from typing import Optional, Union
from bot.constants.emojis import Emojis


class MessageFormatter:
    """æ¶ˆæ¯æ ¼å¼åŒ–å·¥å…·ç±»"""

    @staticmethod
    def format_user_link(user_id: int, name: Optional[str] = None) -> str:
        """
        æ ¼å¼åŒ–ç”¨æˆ·é“¾æ¥

        Args:
            user_id: ç”¨æˆ·çš„ Telegram ID
            name: æ˜¾ç¤ºåç§°ï¼Œå¦‚æœä¸º None åˆ™ä½¿ç”¨ ID

        Returns:
            Markdown æ ¼å¼çš„ç”¨æˆ·é“¾æ¥
        """
        display_name = name or str(user_id)
        return f"[{display_name}](tg://user?id={user_id})"

    @staticmethod
    def format_time(
        dt: Union[datetime, str, None],
        format: str = "%Y-%m-%d %H:%M:%S"
    ) -> str:
        """
        æ ¼å¼åŒ–æ—¶é—´

        Args:
            dt: datetime å¯¹è±¡æˆ–æ—¶é—´å­—ç¬¦ä¸²
            format: æ—¶é—´æ ¼å¼

        Returns:
            æ ¼å¼åŒ–åçš„æ—¶é—´å­—ç¬¦ä¸²
        """
        if dt is None:
            return "æœªçŸ¥"

        if isinstance(dt, str):
            return dt

        return dt.strftime(format)

    @staticmethod
    def format_date(dt: Union[datetime, str, None]) -> str:
        """æ ¼å¼åŒ–æ—¥æœŸï¼ˆä¸å«æ—¶é—´ï¼‰"""
        return MessageFormatter.format_time(dt, "%Y-%m-%d")

    @staticmethod
    def format_datetime_short(dt: Union[datetime, str, None]) -> str:
        """æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´ï¼ˆçŸ­æ ¼å¼ï¼‰"""
        return MessageFormatter.format_time(dt, "%m-%d %H:%M")

    @staticmethod
    def format_status(level: str) -> str:
        """
        æ ¼å¼åŒ–ç”¨æˆ·çŠ¶æ€

        Args:
            level: ç”¨æˆ·ç­‰çº§ (a/b/c/d)

        Returns:
            å¸¦ Emoji çš„çŠ¶æ€æ–‡æœ¬
        """
        emoji = Emojis.get_status_emoji(level)
        text = Emojis.get_level_text(level)
        return f"{emoji} {text}"

    @staticmethod
    def format_code_block(text: str) -> str:
        """æ ¼å¼åŒ–ä¸ºä»£ç å—"""
        return f"`{text}`"

    @staticmethod
    def format_bold(text: str) -> str:
        """æ ¼å¼åŒ–ä¸ºç²—ä½“"""
        return f"**{text}**"

    @staticmethod
    def format_italic(text: str) -> str:
        """æ ¼å¼åŒ–ä¸ºæ–œä½“"""
        return f"__{text}__"

    @staticmethod
    def format_link(text: str, url: str) -> str:
        """æ ¼å¼åŒ–ä¸ºé“¾æ¥"""
        return f"[{text}]({url})"

    @staticmethod
    def truncate_text(text: str, max_length: int = 50, suffix: str = "...") -> str:
        """
        æˆªæ–­é•¿æ–‡æœ¬

        Args:
            text: åŸæ–‡æœ¬
            max_length: æœ€å¤§é•¿åº¦
            suffix: åç¼€

        Returns:
            æˆªæ–­åçš„æ–‡æœ¬
        """
        if len(text) <= max_length:
            return text
        return text[:max_length - len(suffix)] + suffix

    @staticmethod
    def format_file_size(size_bytes: int) -> str:
        """
        æ ¼å¼åŒ–æ–‡ä»¶å¤§å°

        Args:
            size_bytes: å­—èŠ‚æ•°

        Returns:
            äººç±»å¯è¯»çš„å¤§å°ï¼ˆå¦‚ 1.5 MBï¼‰
        """
        for unit in ['B', 'KB', 'MB', 'GB', 'TB']:
            if size_bytes < 1024.0:
                return f"{size_bytes:.1f} {unit}"
            size_bytes /= 1024.0
        return f"{size_bytes:.1f} PB"

    @staticmethod
    def format_duration(seconds: int) -> str:
        """
        æ ¼å¼åŒ–æ—¶é•¿

        Args:
            seconds: ç§’æ•°

        Returns:
            æ ¼å¼åŒ–çš„æ—¶é•¿ï¼ˆå¦‚ 1h 23m 45sï¼‰
        """
        hours, remainder = divmod(seconds, 3600)
        minutes, secs = divmod(remainder, 60)

        parts = []
        if hours > 0:
            parts.append(f"{hours}h")
        if minutes > 0:
            parts.append(f"{minutes}m")
        if secs > 0 or not parts:
            parts.append(f"{secs}s")

        return " ".join(parts)

    @staticmethod
    def format_days_left(expiry_date: datetime) -> str:
        """
        æ ¼å¼åŒ–å‰©ä½™å¤©æ•°

        Args:
            expiry_date: åˆ°æœŸæ—¥æœŸ

        Returns:
            å‰©ä½™å¤©æ•°æè¿°
        """
        now = datetime.now()
        delta = expiry_date - now

        if delta.days < 0:
            return f"{Emojis.ERROR} å·²è¿‡æœŸ {abs(delta.days)} å¤©"
        elif delta.days == 0:
            return f"{Emojis.WARNING} ä»Šå¤©åˆ°æœŸ"
        elif delta.days <= 3:
            return f"{Emojis.WARNING} å‰©ä½™ {delta.days} å¤©"
        elif delta.days <= 7:
            return f"{Emojis.INFO} å‰©ä½™ {delta.days} å¤©"
        else:
            return f"{Emojis.SUCCESS} å‰©ä½™ {delta.days} å¤©"

    @staticmethod
    def format_expiry_time(expiry_date: Union[datetime, str, None]) -> str:
        """
        æ ¼å¼åŒ–åˆ°æœŸæ—¶é—´ï¼ˆåŒ…å«å€’è®¡æ—¶ï¼‰

        Args:
            expiry_date: åˆ°æœŸæ—¥æœŸ

        Returns:
            æ ¼å¼åŒ–çš„åˆ°æœŸä¿¡æ¯
        """
        if expiry_date is None:
            return "æ°¸ä¹…"

        if isinstance(expiry_date, str):
            # å°è¯•è§£æå­—ç¬¦ä¸²
            try:
                expiry_date = datetime.strptime(expiry_date, "%Y-%m-%d %H:%M:%S")
            except:
                return expiry_date

        date_str = MessageFormatter.format_time(expiry_date)
        days_left = MessageFormatter.format_days_left(expiry_date)

        return f"{date_str}\n{days_left}"

    @staticmethod
    def format_list(items: list, numbered: bool = True) -> str:
        """
        æ ¼å¼åŒ–åˆ—è¡¨

        Args:
            items: åˆ—è¡¨é¡¹
            numbered: æ˜¯å¦ç¼–å·

        Returns:
            æ ¼å¼åŒ–çš„åˆ—è¡¨æ–‡æœ¬
        """
        if numbered:
            return "\n".join(f"{i+1}. {item}" for i, item in enumerate(items))
        else:
            return "\n".join(f"â€¢ {item}" for item in items)

    @staticmethod
    def format_table(headers: list, rows: list) -> str:
        """
        æ ¼å¼åŒ–ç®€å•è¡¨æ ¼

        Args:
            headers: è¡¨å¤´åˆ—è¡¨
            rows: è¡Œæ•°æ®åˆ—è¡¨ï¼ˆæ¯è¡Œæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼‰

        Returns:
            æ ¼å¼åŒ–çš„è¡¨æ ¼
        """
        # è®¡ç®—æ¯åˆ—çš„æœ€å¤§å®½åº¦
        col_widths = [len(h) for h in headers]
        for row in rows:
            for i, cell in enumerate(row):
                col_widths[i] = max(col_widths[i], len(str(cell)))

        # ç”Ÿæˆè¡¨æ ¼
        lines = []

        # è¡¨å¤´
        header_line = " | ".join(
            h.ljust(col_widths[i]) for i, h in enumerate(headers)
        )
        lines.append(header_line)
        lines.append("-" * len(header_line))

        # æ•°æ®è¡Œ
        for row in rows:
            row_line = " | ".join(
                str(cell).ljust(col_widths[i]) for i, cell in enumerate(row)
            )
            lines.append(row_line)

        return "\n".join(lines)

    @staticmethod
    def format_progress_bar(
        current: int,
        total: int,
        length: int = 10,
        filled: str = "â–ˆ",
        empty: str = "â–‘"
    ) -> str:
        """
        æ ¼å¼åŒ–è¿›åº¦æ¡

        Args:
            current: å½“å‰è¿›åº¦
            total: æ€»æ•°
            length: è¿›åº¦æ¡é•¿åº¦
            filled: å·²å®Œæˆå­—ç¬¦
            empty: æœªå®Œæˆå­—ç¬¦

        Returns:
            è¿›åº¦æ¡å­—ç¬¦ä¸²
        """
        if total == 0:
            percent = 0
        else:
            percent = current / total

        filled_length = int(length * percent)
        bar = filled * filled_length + empty * (length - filled_length)
        percentage = f"{percent * 100:.1f}%"

        return f"{bar} {percentage}"

    @staticmethod
    def format_user_info_card(user_data: dict) -> str:
        """
        æ ¼å¼åŒ–ç”¨æˆ·ä¿¡æ¯å¡ç‰‡

        Args:
            user_data: ç”¨æˆ·æ•°æ®å­—å…¸

        Returns:
            æ ¼å¼åŒ–çš„ç”¨æˆ·ä¿¡æ¯å¡ç‰‡
        """
        from bot.constants.messages import Messages

        return Messages.USER_INFO_CARD.format(
            tg_id=user_data.get('tg_id', 'æœªçŸ¥'),
            name=MessageFormatter.format_user_link(
                user_data.get('tg_id'),
                user_data.get('name')
            ),
            status_badge=Emojis.get_status_emoji(user_data.get('lv', 'd')),
            status=Emojis.get_level_text(user_data.get('lv', 'd')),
            coin_name=user_data.get('coin_name', 'ç§¯åˆ†'),
            coins=user_data.get('coins', 0),
            emby_username=MessageFormatter.format_code_block(
                user_data.get('emby_name', 'æœªåˆ›å»º')
            ),
            expiry=MessageFormatter.format_expiry_time(user_data.get('ex')),
            register_time=MessageFormatter.format_time(user_data.get('cr')),
        )


class ProgressTracker:
    """è¿›åº¦è·Ÿè¸ªå™¨"""

    def __init__(self, total_steps: int, title: str = "å¤„ç†ä¸­"):
        self.total_steps = total_steps
        self.current_step = 0
        self.title = title
        self.steps = []

    def add_step(self, description: str):
        """æ·»åŠ æ­¥éª¤æè¿°"""
        self.steps.append(description)

    def next_step(self):
        """è¿›å…¥ä¸‹ä¸€æ­¥"""
        self.current_step += 1

    def format_progress(self, message: str = "") -> str:
        """æ ¼å¼åŒ–å½“å‰è¿›åº¦"""
        from bot.constants.messages import Messages

        steps_text = []
        for i, step_desc in enumerate(self.steps, 1):
            if i < self.current_step:
                emoji = Emojis.DONE
            elif i == self.current_step:
                emoji = Emojis.LOADING
            else:
                emoji = "â³"

            steps_text.append(f"{emoji} [{i}/{self.total_steps}] {step_desc}")

        return Messages.PROGRESS_TEMPLATE.format(
            icon=Emojis.LOADING,
            title=self.title,
            steps="\n".join(steps_text),
            message=message
        )
```

---

#### ä»»åŠ¡ 1.5ï¼šåˆ›å»ºè¾“å…¥éªŒè¯å·¥å…·

**æ–‡ä»¶**: `bot/func_helper/validators.py`

```python
"""
è¾“å…¥éªŒè¯å·¥å…·
æä¾›ç»Ÿä¸€çš„è¾“å…¥éªŒè¯åŠŸèƒ½
"""

import re
from typing import Tuple, Optional


class ValidationResult:
    """éªŒè¯ç»“æœç±»"""

    def __init__(self, is_valid: bool, error_message: str = ""):
        self.is_valid = is_valid
        self.error_message = error_message

    def __bool__(self):
        return self.is_valid


class Validators:
    """è¾“å…¥éªŒè¯å™¨"""

    @staticmethod
    def validate_ip(ip_address: str) -> ValidationResult:
        """
        éªŒè¯ IP åœ°å€æ ¼å¼

        Args:
            ip_address: IP åœ°å€å­—ç¬¦ä¸²

        Returns:
            ValidationResult å¯¹è±¡
        """
        pattern = r'^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$'

        if re.match(pattern, ip_address):
            return ValidationResult(True)
        else:
            return ValidationResult(
                False,
                f"IP åœ°å€æ ¼å¼é”™è¯¯ï¼š`{ip_address}`\næ­£ç¡®æ ¼å¼å¦‚ï¼š192.168.1.1"
            )

    @staticmethod
    def validate_username(username: str) -> ValidationResult:
        """
        éªŒè¯ç”¨æˆ·åï¼ˆå…è®¸ä¸­è‹±æ–‡ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ç©ºæ ¼ï¼‰

        Args:
            username: ç”¨æˆ·å

        Returns:
            ValidationResult å¯¹è±¡
        """
        # é•¿åº¦æ£€æŸ¥
        if len(username) < 2:
            return ValidationResult(False, "ç”¨æˆ·åè‡³å°‘éœ€è¦ 2 ä¸ªå­—ç¬¦")

        if len(username) > 20:
            return ValidationResult(False, "ç”¨æˆ·åä¸èƒ½è¶…è¿‡ 20 ä¸ªå­—ç¬¦")

        # å­—ç¬¦æ£€æŸ¥ï¼ˆå…è®¸ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ç©ºæ ¼ï¼‰
        pattern = r'^[\w\u4e00-\u9fa5\s]+$'
        if not re.match(pattern, username):
            return ValidationResult(
                False,
                "ç”¨æˆ·ååªèƒ½åŒ…å«ä¸­è‹±æ–‡ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œç©ºæ ¼\n"
                "ä¸æ”¯æŒç‰¹æ®Šå­—ç¬¦å¦‚ï¼š@#$%^&*()"
            )

        # ä¸èƒ½å…¨æ˜¯ç©ºæ ¼
        if username.strip() == "":
            return ValidationResult(False, "ç”¨æˆ·åä¸èƒ½å…¨æ˜¯ç©ºæ ¼")

        return ValidationResult(True)

    @staticmethod
    def validate_pin(pin: str) -> ValidationResult:
        """
        éªŒè¯å®‰å…¨ç ï¼ˆ4-6 ä½æ•°å­—ï¼‰

        Args:
            pin: å®‰å…¨ç 

        Returns:
            ValidationResult å¯¹è±¡
        """
        if not pin.isdigit():
            return ValidationResult(False, "å®‰å…¨ç å¿…é¡»æ˜¯çº¯æ•°å­—")

        if len(pin) < 4:
            return ValidationResult(False, "å®‰å…¨ç è‡³å°‘éœ€è¦ 4 ä½æ•°å­—")

        if len(pin) > 6:
            return ValidationResult(False, "å®‰å…¨ç ä¸èƒ½è¶…è¿‡ 6 ä½æ•°å­—")

        return ValidationResult(True)

    @staticmethod
    def validate_emby_code(code: str) -> ValidationResult:
        """
        éªŒè¯ Emby æ³¨å†Œç /ç»­æœŸç æ ¼å¼

        Args:
            code: å…‘æ¢ç 

        Returns:
            ValidationResult å¯¹è±¡
        """
        # ç§»é™¤ç©ºæ ¼
        code = code.strip()

        if len(code) == 0:
            return ValidationResult(False, "å…‘æ¢ç ä¸èƒ½ä¸ºç©º")

        # è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…çš„å…‘æ¢ç è§„åˆ™è¿›è¡ŒéªŒè¯
        # ç¤ºä¾‹ï¼šå‡è®¾å…‘æ¢ç æ˜¯ 8-16 ä½å­—æ¯æ•°å­—ç»„åˆ
        if len(code) < 8:
            return ValidationResult(False, "å…‘æ¢ç è‡³å°‘éœ€è¦ 8 ä½å­—ç¬¦")

        if len(code) > 16:
            return ValidationResult(False, "å…‘æ¢ç ä¸èƒ½è¶…è¿‡ 16 ä½å­—ç¬¦")

        return ValidationResult(True)

    @staticmethod
    def validate_days(days_str: str) -> ValidationResult:
        """
        éªŒè¯å¤©æ•°è¾“å…¥ï¼ˆæ”¯æŒ +/- å‰ç¼€ï¼‰

        Args:
            days_str: å¤©æ•°å­—ç¬¦ä¸²ï¼ˆå¦‚ "+30", "-7", "15"ï¼‰

        Returns:
            ValidationResult å¯¹è±¡
        """
        # ç§»é™¤ç©ºæ ¼
        days_str = days_str.strip()

        # æ£€æŸ¥æ ¼å¼
        pattern = r'^[+-]?\d+$'
        if not re.match(pattern, days_str):
            return ValidationResult(
                False,
                "å¤©æ•°æ ¼å¼é”™è¯¯\næ­£ç¡®æ ¼å¼ï¼š+30ï¼ˆå¢åŠ ï¼‰ã€-7ï¼ˆå‡å°‘ï¼‰ã€15ï¼ˆè®¾ç½®ï¼‰"
            )

        try:
            days = int(days_str)
            if abs(days) > 3650:  # æœ€å¤š 10 å¹´
                return ValidationResult(False, "å¤©æ•°ä¸èƒ½è¶…è¿‡ 3650 å¤©ï¼ˆ10å¹´ï¼‰")

            return ValidationResult(True)
        except ValueError:
            return ValidationResult(False, "å¤©æ•°å¿…é¡»æ˜¯æœ‰æ•ˆçš„æ•´æ•°")

    @staticmethod
    def sanitize_text(text: str) -> str:
        """
        æ¸…ç†æ–‡æœ¬ä¸­çš„ç‰¹æ®Šå­—ç¬¦

        Args:
            text: åŸæ–‡æœ¬

        Returns:
            æ¸…ç†åçš„æ–‡æœ¬
        """
        # ç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œåªä¿ç•™ä¸­è‹±æ–‡ã€æ•°å­—ã€å¸¸ç”¨æ ‡ç‚¹
        return re.sub(r'[^\w\s\u4e00-\u9fa5\.,!?ï¼Œã€‚ï¼ï¼Ÿ]', '', text)

    @staticmethod
    def parse_username_pin(input_text: str) -> Tuple[Optional[str], Optional[str], Optional[str]]:
        """
        è§£æç”¨æˆ·åå’Œå®‰å…¨ç è¾“å…¥

        Args:
            input_text: ç”¨æˆ·è¾“å…¥ï¼ˆæ ¼å¼ï¼šç”¨æˆ·å å®‰å…¨ç ï¼‰

        Returns:
            (username, pin, error_message) å…ƒç»„
        """
        # ç§»é™¤é¦–å°¾ç©ºæ ¼
        input_text = input_text.strip()

        # æŒ‰ç©ºæ ¼åˆ†å‰²
        parts = input_text.split()

        if len(parts) < 2:
            return None, None, "è¯·æŒ‰æ ¼å¼è¾“å…¥ï¼šç”¨æˆ·å å®‰å…¨ç \nç¤ºä¾‹ï¼šè‹è‹ 1234"

        if len(parts) > 2:
            return None, None, "è¾“å…¥æ ¼å¼é”™è¯¯ï¼Œç”¨æˆ·åå’Œå®‰å…¨ç ä¹‹é—´åªèƒ½æœ‰ä¸€ä¸ªç©ºæ ¼"

        username, pin = parts

        # éªŒè¯ç”¨æˆ·å
        username_result = Validators.validate_username(username)
        if not username_result:
            return None, None, username_result.error_message

        # éªŒè¯å®‰å…¨ç 
        pin_result = Validators.validate_pin(pin)
        if not pin_result:
            return None, None, pin_result.error_message

        return username, pin, None

    @staticmethod
    def validate_telegram_id(tg_id: str) -> ValidationResult:
        """
        éªŒè¯ Telegram ID

        Args:
            tg_id: Telegram ID

        Returns:
            ValidationResult å¯¹è±¡
        """
        try:
            tg_id_int = int(tg_id)
            if tg_id_int <= 0:
                return ValidationResult(False, "Telegram ID å¿…é¡»æ˜¯æ­£æ•´æ•°")
            return ValidationResult(True)
        except ValueError:
            return ValidationResult(False, "Telegram ID å¿…é¡»æ˜¯æ•°å­—")
```

---

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒæ¨¡å—ä¼˜åŒ–

**ç›®æ ‡**: é‡æ„ä¸»è¦å‘½ä»¤å’Œé¢æ¿æ¨¡å—ï¼Œåº”ç”¨æ–°çš„æ¶ˆæ¯æ¨¡æ¿ç³»ç»Ÿ
**å·¥æœŸ**: 7 ä¸ªå·¥ä½œæ—¥
**ä¼˜å…ˆçº§**: â­â­â­â­

---

#### ä»»åŠ¡ 2.1ï¼šä¼˜åŒ–ç”¨æˆ·æ³¨å†Œæµç¨‹

**æ–‡ä»¶**: `bot/modules/panel/member_panel.py`

**ä¼˜åŒ–è¦ç‚¹ï¼š**
1. ä½¿ç”¨æ–°çš„æ¶ˆæ¯æ¨¡æ¿
2. æ·»åŠ è¿›åº¦æç¤º
3. æ”¹è¿›é”™è¯¯å¤„ç†
4. ä¼˜åŒ–æŒ‰é’®å¸ƒå±€

**ç¤ºä¾‹æ”¹åŠ¨ï¼š**

```python
# åŸä»£ç ï¼ˆç¬¬ 34-42 è¡Œï¼‰
msg = await ask_return(call,
    text='ğŸ¤–**æ³¨æ„ï¼šæ‚¨å·²è¿›å…¥æ³¨å†ŒçŠ¶æ€:\n\nâ€¢ è¯·åœ¨2minå†…è¾“å…¥ `[ç”¨æˆ·å][ç©ºæ ¼][å®‰å…¨ç ]`\nâ€¢ ä¸¾ä¸ªä¾‹å­ğŸŒ°ï¼š`è‹è‹ 1234`**\n\nâ€¢ ç”¨æˆ·åä¸­ä¸é™åˆ¶ä¸­/è‹±æ–‡/emojiï¼ŒğŸš«**ç‰¹æ®Šå­—ç¬¦**'
         '\nâ€¢ å®‰å…¨ç ä¸ºæ•æ„Ÿæ“ä½œæ—¶é™„åŠ éªŒè¯ï¼Œè¯·å¡«å…¥æœ€ç†Ÿæ‚‰çš„æ•°å­—4~6ä½ï¼›é€€å‡ºè¯·ç‚¹ /cancel', timer=120,
    button=close_it_ikb)

# ä¼˜åŒ–å
from bot.constants.messages import Messages
from bot.func_helper.validators import Validators

msg = await ask_return(
    call,
    text=Messages.ACCOUNT_CREATE_START.format(timeout=120),
    timer=120,
    button=close_it_ikb
)

if not msg:
    return

# è§£æå’ŒéªŒè¯è¾“å…¥
username, pin, error = Validators.parse_username_pin(msg.text)

if error:
    await sendMessage(
        msg,
        Messages.ERROR_INVALID_FORMAT.format(
            input=msg.text,
            correct_format="ç”¨æˆ·å å®‰å…¨ç ",
            example="è‹è‹ 1234"
        )
    )
    return

# æ˜¾ç¤ºè¿›åº¦
from bot.func_helper.message_formatter import ProgressTracker

progress = ProgressTracker(4, "åˆ›å»ºè´¦æˆ·")
progress.add_step("éªŒè¯è¾“å…¥ä¿¡æ¯")
progress.add_step("è¿æ¥ Emby æœåŠ¡å™¨")
progress.add_step("åˆ›å»ºç”¨æˆ·è´¦æˆ·")
progress.add_step("é…ç½®ç”¨æˆ·æƒé™")

progress_msg = await sendMessage(msg, progress.format_progress())

# æ­¥éª¤ 1ï¼šéªŒè¯ï¼ˆå·²å®Œæˆï¼‰
progress.next_step()
await editMessage(progress_msg, progress.format_progress("éªŒè¯é€šè¿‡"))

# æ­¥éª¤ 2ï¼šè¿æ¥æœåŠ¡å™¨
progress.next_step()
await editMessage(progress_msg, progress.format_progress("æ­£åœ¨è¿æ¥..."))

# ... åç»­æ­¥éª¤
```

---

#### ä»»åŠ¡ 2.2ï¼šä¼˜åŒ–é”™è¯¯æç¤º

**å½±å“æ–‡ä»¶ï¼š**
- `bot/modules/commands/rmemby.py`
- `bot/modules/commands/exchange.py`
- `bot/modules/panel/member_panel.py`
- `bot/modules/extra/create.py`

**ä¼˜åŒ–ç¤ºä¾‹ï¼š**

```python
# åŸä»£ç ï¼ˆbot/modules/commands/rmemby.py ç¬¬ 29 è¡Œï¼‰
return await reply.edit(f"â™»ï¸ æ²¡æœ‰æ£€ç´¢åˆ° {b} è´¦æˆ·ï¼Œè¯·ç¡®è®¤é‡è¯•æˆ–æ‰‹åŠ¨æ£€æŸ¥ã€‚")

# ä¼˜åŒ–å
from bot.constants.messages import Messages

return await reply.edit(
    Messages.ERROR_USER_NOT_FOUND.format(user_id=b)
)
```

---

#### ä»»åŠ¡ 2.3ï¼šç»Ÿä¸€æŒ‰é’®é£æ ¼

**æ–‡ä»¶**: `bot/func_helper/fix_bottons.py`

**ä¼˜åŒ–è¦ç‚¹ï¼š**
1. ä½¿ç”¨ `ButtonConfig` ä¸­å®šä¹‰çš„æŒ‰é’®æ–‡æœ¬
2. ç»Ÿä¸€æŒ‰é’®æ’åˆ—è§„åˆ™
3. è§„èŒƒ Emoji ä½¿ç”¨

**ç¤ºä¾‹æ”¹åŠ¨ï¼š**

```python
# åŸä»£ç ï¼ˆç¬¬ 54-60 è¡Œï¼‰
normal = [[('ğŸª å…‘æ¢å•†åº—', 'storeall'), ('ğŸ—‘ï¸ åˆ é™¤è´¦å·', 'delme')],
          [('ğŸ¬ æ˜¾ç¤º/éšè—', 'embyblock'), ('â­• é‡ç½®å¯†ç ', 'reset')],
          [('ğŸ’– æˆ‘çš„æ”¶è—', 'my_favorites'),('ğŸ’  æˆ‘çš„è®¾å¤‡', 'my_devices')],
          ]

# ä¼˜åŒ–åï¼ˆä½¿ç”¨ ButtonLayoutsï¼‰
from bot.constants.buttons import ButtonLayouts

normal = ButtonLayouts.user_main_panel()

# æˆ–è€…æ‰‹åŠ¨æ„å»ºï¼ˆä½¿ç”¨ ButtonConfigï¼‰
from bot.constants.buttons import ButtonConfig as BC

normal = ikb([
    [(BC.USER_PANEL['my_info'], 'me'),
     (BC.USER_PANEL['my_favorites'], 'my_favorites')],
    [(BC.USER_PANEL['reset_password'], 'reset'),
     (BC.USER_PANEL['my_devices'], 'my_devices')],
    [(BC.USER_PANEL['store'], 'storeall'),
     (BC.USER_PANEL['show_hide'], 'embyblock')],
    [(BC.USER_PANEL['delete_account'], 'delme')],
])
```

---

#### ä»»åŠ¡ 2.4ï¼šä¼˜åŒ–ç”¨æˆ·ä¿¡æ¯å±•ç¤º

**æ–‡ä»¶**: `bot/modules/commands/start.py`

**ç¤ºä¾‹æ”¹åŠ¨ï¼š**

```python
# åŸä»£ç ï¼ˆç¬¬ 82-88 è¡Œï¼‰
text = f"**âœ¨ åªæœ‰ä½ æƒ³è§æˆ‘çš„æ—¶å€™æˆ‘ä»¬çš„ç›¸é‡æ‰æœ‰æ„ä¹‰**\n\n" \
       f"ğŸ‰__ä½ å¥½é¸­ [{msg.from_user.first_name}](tg://user?id={msg.from_user.id}) \n\n" \
       # ... æ›´å¤šç¡¬ç¼–ç æ–‡æœ¬

# ä¼˜åŒ–å
from bot.constants.messages import Messages
from bot.func_helper.message_formatter import MessageFormatter

user_data = {
    'tg_id': msg.from_user.id,
    'name': msg.from_user.first_name,
    'lv': user.lv,
    'coins': user.iv,
    'coin_name': sakura_b,
    'emby_name': user.name,
    'ex': user.ex,
    'cr': user.cr,
}

text = MessageFormatter.format_user_info_card(user_data)
```

---

### é˜¶æ®µä¸‰ï¼šç”¨æˆ·ä½“éªŒæå‡

**ç›®æ ‡**: å®Œå–„å¸®åŠ©ç³»ç»Ÿã€æ·»åŠ æ–°æ‰‹å¼•å¯¼ã€ä¼˜åŒ–äº¤äº’æµç¨‹
**å·¥æœŸ**: 5 ä¸ªå·¥ä½œæ—¥
**ä¼˜å…ˆçº§**: â­â­â­

---

#### ä»»åŠ¡ 3.1ï¼šåˆ›å»ºç”¨æˆ·å¸®åŠ©æ–‡æ¡£

**æ–°å»ºæ–‡ä»¶**: `docs/USER_GUIDE.md`

```markdown
# EmbyBot ç”¨æˆ·æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### 1. é¦–æ¬¡ä½¿ç”¨

1. ç‚¹å‡» /start å¼€å§‹ä½¿ç”¨
2. æœºå™¨äººä¼šè‡ªåŠ¨å°†ä½ å½•å…¥æ•°æ®åº“
3. ç‚¹å‡»"åˆ›å»ºè´¦æˆ·"æŒ‰é’®å¼€å§‹åˆ›å»º Emby è´¦æˆ·

### 2. åˆ›å»ºè´¦æˆ·

1. åœ¨ä¸»é¢æ¿ç‚¹å‡»"ğŸ¨ åˆ›å»ºè´¦æˆ·"
2. æŒ‰æ ¼å¼è¾“å…¥ï¼š`ç”¨æˆ·å å®‰å…¨ç `
   - ç¤ºä¾‹ï¼š`è‹è‹ 1234`
3. ç­‰å¾…ç³»ç»Ÿåˆ›å»ºè´¦æˆ·
4. è®°å½•ä½ çš„ç”¨æˆ·åå’Œå¯†ç 

### 3. ç™»å½• Emby

1. ä¸‹è½½ Emby å®¢æˆ·ç«¯
2. è¾“å…¥æœåŠ¡å™¨åœ°å€
3. ä½¿ç”¨åˆ›å»ºçš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•

## å¸¸ç”¨åŠŸèƒ½

### é‡ç½®å¯†ç 

1. åœ¨ä¸»é¢æ¿ç‚¹å‡»"ğŸ”‘ é‡ç½®å¯†ç "
2. è¾“å…¥å®‰å…¨ç ç¡®è®¤
3. è·å–æ–°å¯†ç 

### ç»­æœŸè´¦æˆ·

1. è·å–ç»­æœŸç 
2. ä½¿ç”¨ /exchange å‘½ä»¤
3. è¾“å…¥ç»­æœŸç å®Œæˆç»­æœŸ

### æŸ¥çœ‹æ”¶è—

ç‚¹å‡»ä¸»é¢æ¿"ğŸ’– æˆ‘çš„æ”¶è—"æŸ¥çœ‹ä½ æ”¶è—çš„å½±ç‰‡

## å¸¸è§é—®é¢˜

è§ FAQ.md

## è”ç³»æ”¯æŒ

å¦‚éœ€å¸®åŠ©ï¼Œè¯·è”ç³»ç®¡ç†å‘˜
```

---

#### ä»»åŠ¡ 3.2ï¼šåˆ›å»º FAQ æ–‡æ¡£

**æ–°å»ºæ–‡ä»¶**: `docs/FAQ.md`

```markdown
# å¸¸è§é—®é¢˜è§£ç­” (FAQ)

## è´¦æˆ·ç›¸å…³

### Q: å¦‚ä½•åˆ›å»º Emby è´¦æˆ·ï¼Ÿ
A: ç‚¹å‡» /start å¬å”¤é¢æ¿ï¼Œé€‰æ‹©"åˆ›å»ºè´¦æˆ·"ï¼ŒæŒ‰æç¤ºè¾“å…¥ç”¨æˆ·åå’Œå®‰å…¨ç å³å¯ã€‚

### Q: å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ
A: åœ¨ä¸»é¢æ¿ä¸­é€‰æ‹©"é‡ç½®å¯†ç "ï¼Œè¾“å…¥å®‰å…¨ç éªŒè¯åå³å¯è·å¾—æ–°å¯†ç ã€‚

### Q: å¿˜è®°å®‰å…¨ç æ€ä¹ˆåŠï¼Ÿ
A: è”ç³»ç®¡ç†å‘˜ååŠ©é‡ç½®ã€‚ä¸ºäº†è´¦æˆ·å®‰å…¨ï¼Œè¯·å¦¥å–„ä¿ç®¡å®‰å…¨ç ã€‚

### Q: å¯ä»¥ä¿®æ”¹ç”¨æˆ·åå—ï¼Ÿ
A: ä¸æ”¯æŒä¿®æ”¹ç”¨æˆ·åã€‚å¦‚éœ€æ›´æ¢ï¼Œè¯·åˆ é™¤æ—§è´¦æˆ·åé‡æ–°åˆ›å»ºã€‚

## ä½¿ç”¨ç›¸å…³

### Q: å¯ä»¥åœ¨å¤šä¸ªè®¾å¤‡ä¸Šä½¿ç”¨å—ï¼Ÿ
A: å¯ä»¥ï¼Œä½†åŒæ—¶æ’­æ”¾çš„è®¾å¤‡æ•°é‡æœ‰é™åˆ¶ï¼ˆé»˜è®¤2å°ï¼‰ã€‚

### Q: ä¸ºä»€ä¹ˆæ— æ³•æ’­æ”¾æŸäº›è§†é¢‘ï¼Ÿ
A: å¯èƒ½åŸå› ï¼š
- è®¾å¤‡ç¼–è§£ç èƒ½åŠ›ä¸è¶³
- ç½‘ç»œé€Ÿåº¦è¾ƒæ…¢
- æ–‡ä»¶æœ¬èº«å­˜åœ¨é—®é¢˜
å»ºè®®å°è¯•è½¬ç æ’­æ”¾æˆ–è”ç³»ç®¡ç†å‘˜

### Q: å¦‚ä½•æŸ¥çœ‹æˆ‘çš„è§‚çœ‹å†å²ï¼Ÿ
A: åœ¨ Emby å®¢æˆ·ç«¯ä¸­å¯ä»¥æŸ¥çœ‹ç»§ç»­è§‚çœ‹åˆ—è¡¨

## ç»­æœŸç›¸å…³

### Q: è´¦æˆ·åˆ°æœŸåä¼šæ€æ ·ï¼Ÿ
A: åˆ°æœŸåå°†æ— æ³•ç™»å½•ï¼Œä½†æ•°æ®ä¿ç•™7å¤©ã€‚7å¤©å†…ç»­æœŸå¯æ¢å¤ä½¿ç”¨ã€‚

### Q: å¦‚ä½•è·å–ç»­æœŸç ï¼Ÿ
A: é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š
- è´­ä¹°ç»­æœŸç 
- å‚ä¸æ´»åŠ¨è·å¾—
- è”ç³»ç®¡ç†å‘˜

### Q: ç»­æœŸç å¯ä»¥å åŠ ä½¿ç”¨å—ï¼Ÿ
A: å¯ä»¥ï¼Œå¤šä¸ªç»­æœŸç çš„æ—¶é•¿ä¼šç´¯åŠ ã€‚

## æŠ€æœ¯é—®é¢˜

### Q: å“ªäº›è®¾å¤‡æ”¯æŒ Embyï¼Ÿ
A: Emby æ”¯æŒå¤šç§è®¾å¤‡ï¼š
- iOS / Android æ‰‹æœº/å¹³æ¿
- Windows / Mac / Linux ç”µè„‘
- Apple TV / Android TV
- æµè§ˆå™¨ï¼ˆWeb ç‰ˆï¼‰

### Q: æ¨èä½¿ç”¨å“ªä¸ªå®¢æˆ·ç«¯ï¼Ÿ
A: æ¨èä½¿ç”¨å®˜æ–¹ Emby å®¢æˆ·ç«¯ï¼Œä½“éªŒæœ€ä½³

### Q: è§†é¢‘å¡é¡¿æ€ä¹ˆåŠï¼Ÿ
A: å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š
1. é™ä½è§†é¢‘è´¨é‡
2. ä½¿ç”¨è½¬ç æ’­æ”¾
3. æ£€æŸ¥ç½‘ç»œè¿æ¥
4. æ›´æ¢æ’­æ”¾å™¨

## å…¶ä»–é—®é¢˜

### Q: å¦‚ä½•è”ç³»ç®¡ç†å‘˜ï¼Ÿ
A: [ç®¡ç†å‘˜è”ç³»æ–¹å¼]

### Q: æœ‰ä½¿ç”¨æ•™ç¨‹è§†é¢‘å—ï¼Ÿ
A: [æ•™ç¨‹é“¾æ¥]

---

æ‰¾ä¸åˆ°ç­”æ¡ˆï¼Ÿä½¿ç”¨ /help å‘½ä»¤æˆ–è”ç³»ç®¡ç†å‘˜
```

---

#### ä»»åŠ¡ 3.3ï¼šå®ç° /help å‘½ä»¤

**æ–°å»ºæ–‡ä»¶**: `bot/modules/commands/help.py`

```python
"""
å¸®åŠ©å‘½ä»¤
æ˜¾ç¤ºå‘½ä»¤åˆ—è¡¨å’Œä½¿ç”¨è¯´æ˜
"""

from pyrogram import filters
from bot import bot, admin_p, user_p, owner_p
from bot.constants.messages import Messages
from bot.func_helper.msg_utils import sendMessage
from bot.func_helper.fix_bottons import ikb


@bot.on_message(filters.command('help') & user_p)
async def help_command(client, msg):
    """æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯"""

    # è·å–ç”¨æˆ·æƒé™ç­‰çº§
    user_id = msg.from_user.id
    is_admin = user_id in admin_p or user_id in owner_p

    # æ„å»ºå¸®åŠ©æŒ‰é’®
    help_buttons = ikb([
        [('ğŸ“š å‘½ä»¤åˆ—è¡¨', 'help_commands'),
         ('â“ å¸¸è§é—®é¢˜', 'help_faq')],
        [('ğŸ“– ä½¿ç”¨æ•™ç¨‹', 'help_guide'),
         ('ğŸ’¬ è”ç³»ç®¡ç†', 'help_contact')],
    ])

    if is_admin:
        help_buttons.inline_keyboard.append(
            [('ğŸ”§ ç®¡ç†å‘˜å‘½ä»¤', 'help_admin')]
        )

    # å‘é€å¸®åŠ©æ¶ˆæ¯
    help_text = Messages.HELP_COMMAND_LIST.format(
        admin_contact="@admin"  # ä»é…ç½®è¯»å–
    )

    await sendMessage(msg, help_text, button=help_buttons)


@bot.on_message(filters.command('faq') & user_p)
async def faq_command(client, msg):
    """æ˜¾ç¤ºå¸¸è§é—®é¢˜"""
    await sendMessage(msg, Messages.HELP_FAQ.format(
        admin_contact="@admin",
        faq_url="https://docs.example.com/faq"
    ))


@bot.on_message(filters.command('guide') & user_p)
async def guide_command(client, msg):
    """æ˜¾ç¤ºä½¿ç”¨æŒ‡å—"""
    guide_text = """
ğŸ“– **ä½¿ç”¨æŒ‡å—**

**å®Œæ•´æ–‡æ¡£ï¼š** https://docs.example.com

**å¿«é€Ÿå¯¼èˆªï¼š**
â€¢ åˆ›å»ºè´¦æˆ·æŒ‡å—
â€¢ å®¢æˆ·ç«¯ä¸‹è½½å’Œå®‰è£…
â€¢ å¸¸è§é—®é¢˜æ’æŸ¥
â€¢ é«˜çº§åŠŸèƒ½ä½¿ç”¨

éœ€è¦å¸®åŠ©ï¼Ÿä½¿ç”¨ /faq æŸ¥çœ‹å¸¸è§é—®é¢˜
"""
    await sendMessage(msg, guide_text)
```

---

#### ä»»åŠ¡ 3.4ï¼šä¼˜åŒ–æ–°ç”¨æˆ·å¼•å¯¼

**æ–‡ä»¶**: `bot/modules/commands/start.py`

**åœ¨ç”¨æˆ·é¦–æ¬¡ä½¿ç”¨æ—¶æ˜¾ç¤ºè¯¦ç»†å¼•å¯¼ï¼š**

```python
# åœ¨ç¬¬ä¸€æ¬¡ /start æ—¶ï¼ˆæ•°æ®åº“æ— è®°å½•ï¼‰
if is_first_time:
    # å½•å…¥æ•°æ®åº“
    add_user(user_id, username)

    # å‘é€æ¬¢è¿æ¶ˆæ¯
    welcome_text = Messages.SYSTEM_WELCOME.format(
        first_name=msg.from_user.first_name
    )

    welcome_buttons = ikb([
        [('ğŸ¨ åˆ›å»ºè´¦æˆ·', 'create_account')],
        [('ğŸ“– æŸ¥çœ‹æ•™ç¨‹', 'help_guide'),
         ('â“ å¸¸è§é—®é¢˜', 'help_faq')],
    ])

    await sendMessage(msg, welcome_text, button=welcome_buttons)
```

---

### é˜¶æ®µå››ï¼šé«˜çº§åŠŸèƒ½å®Œå–„

**ç›®æ ‡**: æ·»åŠ è¿›åº¦è¿½è¸ªã€æ“ä½œå†å²ã€ç»Ÿè®¡åˆ†æç­‰é«˜çº§åŠŸèƒ½
**å·¥æœŸ**: 5 ä¸ªå·¥ä½œæ—¥
**ä¼˜å…ˆçº§**: â­â­

---

#### ä»»åŠ¡ 4.1ï¼šå®ç°æ“ä½œè¿›åº¦è¿½è¸ª

**ä½¿ç”¨åœºæ™¯ï¼š**
- æ‰¹é‡æ“ä½œç”¨æˆ·
- åŒæ­¥æ•°æ®
- ç”Ÿæˆæ¦œå•
- æ•°æ®åº“å¤‡ä»½

**ç¤ºä¾‹ï¼š**

```python
# bot/modules/commands/syncs.py - ç¾¤ç»„åŒæ­¥ä¼˜åŒ–

from bot.func_helper.message_formatter import ProgressTracker

async def sync_group_members(msg):
    """åŒæ­¥ç¾¤ç»„æˆå‘˜"""

    # è·å–æ‰€æœ‰éœ€è¦æ£€æŸ¥çš„ç”¨æˆ·
    all_users = get_all_emby_users()
    total = len(all_users)

    # åˆ›å»ºè¿›åº¦è·Ÿè¸ª
    progress = ProgressTracker(3, "ç¾¤ç»„åŒæ­¥")
    progress.add_step(f"è·å–ç¾¤ç»„æˆå‘˜åˆ—è¡¨")
    progress.add_step(f"æ£€æŸ¥ {total} ä¸ªç”¨æˆ·")
    progress.add_step("å¤„ç†ä¸åœ¨ç¾¤ç»„çš„ç”¨æˆ·")

    progress_msg = await sendMessage(msg, progress.format_progress())

    # æ­¥éª¤ 1
    progress.next_step()
    group_members = await get_group_members()
    await editMessage(
        progress_msg,
        progress.format_progress(f"æ‰¾åˆ° {len(group_members)} ä¸ªç¾¤ç»„æˆå‘˜")
    )

    # æ­¥éª¤ 2
    progress.next_step()
    not_in_group = []

    for i, user in enumerate(all_users):
        if user.tg_id not in group_members:
            not_in_group.append(user)

        # æ¯å¤„ç† 10 ä¸ªæ›´æ–°ä¸€æ¬¡è¿›åº¦
        if i % 10 == 0:
            await editMessage(
                progress_msg,
                progress.format_progress(
                    f"å·²æ£€æŸ¥ {i+1}/{total} ä¸ªç”¨æˆ·\n"
                    f"å‘ç° {len(not_in_group)} ä¸ªä¸åœ¨ç¾¤ç»„"
                )
            )

    # æ­¥éª¤ 3
    progress.next_step()
    await editMessage(
        progress_msg,
        progress.format_progress("æ­£åœ¨å¤„ç†...")
    )

    # å¤„ç†ä¸åœ¨ç¾¤ç»„çš„ç”¨æˆ·
    for user in not_in_group:
        # æ‰§è¡Œå¤„ç†æ“ä½œ
        pass

    # å®Œæˆ
    await editMessage(progress_msg, f"""
âœ… **åŒæ­¥å®Œæˆ**

ğŸ“Š ç»Ÿè®¡ç»“æœï¼š
â€¢ æ€»ç”¨æˆ·æ•°ï¼š{total}
â€¢ åœ¨ç¾¤ç»„ï¼š{total - len(not_in_group)}
â€¢ ä¸åœ¨ç¾¤ç»„ï¼š{len(not_in_group)}
â€¢ å·²å¤„ç†ï¼š{len(not_in_group)}

æ“ä½œå®Œæˆæ—¶é—´ï¼š{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
""")
```

---

#### ä»»åŠ¡ 4.2ï¼šä¼˜åŒ–å®¡è®¡æŠ¥å‘Š

**æ–‡ä»¶**: `bot/modules/commands/audit.py`

**æ”¹è¿›è¦ç‚¹ï¼š**
1. ä½¿ç”¨æ–°çš„æ¶ˆæ¯æ¨¡æ¿
2. åˆ†é¡µæ˜¾ç¤ºç»“æœ
3. æ·»åŠ é£é™©è¯„ä¼°
4. æä¾›å¯¼å‡ºåŠŸèƒ½

**ç¤ºä¾‹ï¼š**

```python
from bot.constants.messages import Messages
from bot.func_helper.message_formatter import MessageFormatter

async def generate_ip_audit_report(ip_address: str, days: int = None):
    """ç”Ÿæˆ IP å®¡è®¡æŠ¥å‘Š"""

    # æŸ¥è¯¢æ•°æ®
    results = query_ip_usage(ip_address, days)

    # é£é™©è¯„ä¼°
    user_count = len(results)
    if user_count >= 5:
        risk_level = "ğŸ”´ é«˜é£é™©"
        risk_desc = "è¯¥ IP è¢«å¤šä¸ªè´¦æˆ·ä½¿ç”¨ï¼Œå¯èƒ½å­˜åœ¨è´¦å·å…±äº«è¡Œä¸º"
    elif user_count >= 3:
        risk_level = "ğŸŸ¡ ä¸­é£é™©"
        risk_desc = "è¯¥ IP è¢«å°‘æ•°è´¦æˆ·ä½¿ç”¨ï¼Œå»ºè®®å…³æ³¨"
    else:
        risk_level = "ğŸŸ¢ ä½é£é™©"
        risk_desc = "æ­£å¸¸ä½¿ç”¨èŒƒå›´å†…"

    # æ„å»ºç”¨æˆ·åˆ—è¡¨
    user_list_items = []
    for i, (user, count, last_time) in enumerate(results, 1):
        user_list_items.append(
            f"{i}. {MessageFormatter.format_user_link(user.tg_id, user.name)}\n"
            f"   â€¢ Emby: `{user.emby_name}`\n"
            f"   â€¢ è®¿é—®æ¬¡æ•°: {count}\n"
            f"   â€¢ æœ€åè®¿é—®: {MessageFormatter.format_datetime_short(last_time)}"
        )

    # ç”ŸæˆæŠ¥å‘Š
    report = Messages.AUDIT_IP_REPORT.format(
        ip_address=ip_address,
        time_range=f"æœ€è¿‘ {days} å¤©" if days else "å…¨éƒ¨æ—¶é—´",
        user_count=user_count,
        user_list="\n\n".join(user_list_items),
        risk_assessment=f"{risk_level}\n{risk_desc}",
        suggestions="â€¢ å¦‚å‘ç°å¼‚å¸¸ï¼Œå»ºè®®è¿›ä¸€æ­¥è°ƒæŸ¥\nâ€¢ å¿…è¦æ—¶å¯é™åˆ¶è¯¥ IP è®¿é—®"
    )

    return report
```

---

#### ä»»åŠ¡ 4.3ï¼šæ·»åŠ æ“ä½œç¡®è®¤æœºåˆ¶

**é€‚ç”¨åœºæ™¯ï¼š**
- åˆ é™¤è´¦æˆ·
- æ‰¹é‡æ“ä½œ
- æ¸…é™¤æ•°æ®

**ç¤ºä¾‹ï¼š**

```python
# bot/modules/commands/rmemby.py - åˆ é™¤è´¦æˆ·ç¡®è®¤

from bot.constants.messages import Messages
from bot.func_helper.fix_bottons import ikb

async def delete_emby_user(msg, user_id):
    """åˆ é™¤ Emby ç”¨æˆ·ï¼ˆå¸¦ç¡®è®¤ï¼‰"""

    # è·å–ç”¨æˆ·ä¿¡æ¯
    user = get_emby_user(user_id)

    if not user:
        await sendMessage(msg, Messages.ERROR_USER_NOT_FOUND.format(user_id=user_id))
        return

    # å‘é€ç¡®è®¤æ¶ˆæ¯
    confirm_text = Messages.ACCOUNT_DELETE_CONFIRM.format(
        username=user.name,
        user_id=user.tg_id,
        create_time=MessageFormatter.format_time(user.cr)
    )

    confirm_buttons = ikb([
        [('âœ… ç¡®è®¤åˆ é™¤', f'confirm_delete_{user_id}'),
         ('âŒ å–æ¶ˆ', 'cancel')],
    ])

    await sendMessage(msg, confirm_text, button=confirm_buttons)


# å›è°ƒå¤„ç†
@bot.on_callback_query(filters.regex(r'^confirm_delete_(\d+)$'))
async def confirm_delete_callback(client, call):
    """ç¡®è®¤åˆ é™¤çš„å›è°ƒ"""

    user_id = int(call.matches[0].group(1))

    # æ‰§è¡Œåˆ é™¤
    result = delete_user_from_emby(user_id)

    if result.success:
        success_text = Messages.ACCOUNT_DELETE_SUCCESS.format(
            username=result.username,
            time=datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        )
        await editMessage(call, success_text)
    else:
        await editMessage(call, f"åˆ é™¤å¤±è´¥ï¼š{result.error}")
```

---

## äº”ã€å®æ–½è®¡åˆ’

### 5.1 æ—¶é—´è¡¨

| é˜¶æ®µ | ä»»åŠ¡ | å·¥æœŸ | èµ·æ­¢æ—¶é—´ | è´Ÿè´£äºº |
|------|------|------|----------|--------|
| é˜¶æ®µä¸€ | åŸºç¡€æ¶æ„å»ºè®¾ | 5 å¤© | D1-D5 | å¼€å‘å›¢é˜Ÿ |
| | 1.1 åˆ›å»ºæ¶ˆæ¯æ¨¡æ¿ç³»ç»Ÿ | 2 å¤© | D1-D2 | |
| | 1.2 åˆ›å»º Emoji è§„èŒƒ | 0.5 å¤© | D3 | |
| | 1.3 åˆ›å»ºæŒ‰é’®é…ç½®è§„èŒƒ | 0.5 å¤© | D3 | |
| | 1.4 åˆ›å»ºæ¶ˆæ¯æ ¼å¼åŒ–å·¥å…· | 1 å¤© | D4 | |
| | 1.5 åˆ›å»ºè¾“å…¥éªŒè¯å·¥å…· | 1 å¤© | D5 | |
| é˜¶æ®µäºŒ | æ ¸å¿ƒæ¨¡å—ä¼˜åŒ– | 7 å¤© | D6-D12 | å¼€å‘å›¢é˜Ÿ |
| | 2.1 ä¼˜åŒ–ç”¨æˆ·æ³¨å†Œæµç¨‹ | 2 å¤© | D6-D7 | |
| | 2.2 ä¼˜åŒ–é”™è¯¯æç¤º | 2 å¤© | D8-D9 | |
| | 2.3 ç»Ÿä¸€æŒ‰é’®é£æ ¼ | 2 å¤© | D10-D11 | |
| | 2.4 ä¼˜åŒ–ç”¨æˆ·ä¿¡æ¯å±•ç¤º | 1 å¤© | D12 | |
| é˜¶æ®µä¸‰ | ç”¨æˆ·ä½“éªŒæå‡ | 5 å¤© | D13-D17 | å¼€å‘å›¢é˜Ÿ |
| | 3.1 åˆ›å»ºç”¨æˆ·å¸®åŠ©æ–‡æ¡£ | 1 å¤© | D13 | |
| | 3.2 åˆ›å»º FAQ æ–‡æ¡£ | 1 å¤© | D14 | |
| | 3.3 å®ç° /help å‘½ä»¤ | 2 å¤© | D15-D16 | |
| | 3.4 ä¼˜åŒ–æ–°ç”¨æˆ·å¼•å¯¼ | 1 å¤© | D17 | |
| é˜¶æ®µå›› | é«˜çº§åŠŸèƒ½å®Œå–„ | 5 å¤© | D18-D22 | å¼€å‘å›¢é˜Ÿ |
| | 4.1 å®ç°æ“ä½œè¿›åº¦è¿½è¸ª | 2 å¤© | D18-D19 | |
| | 4.2 ä¼˜åŒ–å®¡è®¡æŠ¥å‘Š | 2 å¤© | D20-D21 | |
| | 4.3 æ·»åŠ æ“ä½œç¡®è®¤æœºåˆ¶ | 1 å¤© | D22 | |
| æµ‹è¯• | å…¨é¢æµ‹è¯•å’Œä¿®å¤ | 3 å¤© | D23-D25 | æµ‹è¯•å›¢é˜Ÿ |
| éƒ¨ç½² | ç°åº¦å‘å¸ƒå’Œæ­£å¼ä¸Šçº¿ | 2 å¤© | D26-D27 | è¿ç»´å›¢é˜Ÿ |

**æ€»è®¡å·¥æœŸï¼š27 ä¸ªå·¥ä½œæ—¥ï¼ˆçº¦ 5.4 å‘¨ï¼‰**

### 5.2 é‡Œç¨‹ç¢‘

- âœ… **M1 (D5)**: åŸºç¡€æ¶æ„å®Œæˆï¼Œæ¶ˆæ¯æ¨¡æ¿ç³»ç»Ÿå¯ç”¨
- âœ… **M2 (D12)**: æ ¸å¿ƒæ¨¡å—é‡æ„å®Œæˆï¼Œæ–°ç³»ç»Ÿå…¨é¢åº”ç”¨
- âœ… **M3 (D17)**: ç”¨æˆ·ä½“éªŒä¼˜åŒ–å®Œæˆï¼Œå¸®åŠ©ç³»ç»Ÿä¸Šçº¿
- âœ… **M4 (D22)**: æ‰€æœ‰åŠŸèƒ½å¼€å‘å®Œæˆ
- âœ… **M5 (D25)**: æµ‹è¯•å®Œæˆï¼Œå‡†å¤‡ä¸Šçº¿
- ğŸš€ **M6 (D27)**: æ­£å¼ä¸Šçº¿

### 5.3 èµ„æºéœ€æ±‚

**äººåŠ›ï¼š**
- å¼€å‘å·¥ç¨‹å¸ˆï¼š2 äºº
- æµ‹è¯•å·¥ç¨‹å¸ˆï¼š1 äºº
- è¿ç»´å·¥ç¨‹å¸ˆï¼š1 äºº

**æŠ€æœ¯ï¼š**
- Python 3.8+
- Pyrogram
- MySQL
- Git

**å·¥å…·ï¼š**
- ç‰ˆæœ¬æ§åˆ¶ï¼šGit
- é¡¹ç›®ç®¡ç†ï¼šGitHub Issues
- ä»£ç å®¡æŸ¥ï¼šGitHub Pull Request

---

## å…­ã€è´¨é‡ä¿è¯

### 6.1 ä»£ç å®¡æŸ¥æ¸…å•

**æ¶ˆæ¯æ¨¡æ¿ä½¿ç”¨ï¼š**
- [ ] æ‰€æœ‰ç¡¬ç¼–ç æ¶ˆæ¯å·²è¿ç§»åˆ° `Messages` ç±»
- [ ] æ¶ˆæ¯æ ¼å¼ç»Ÿä¸€ä½¿ç”¨ `.format()` æ–¹æ³•
- [ ] åŠ¨æ€å†…å®¹æ­£ç¡®ä¼ é€’å‚æ•°

**Emoji ä½¿ç”¨ï¼š**
- [ ] æ‰€æœ‰ Emoji ä½¿ç”¨ `Emojis` ç±»ä¸­å®šä¹‰çš„å¸¸é‡
- [ ] æŒ‰é’® Emoji ä½¿ç”¨ `ButtonEmojis` ç±»
- [ ] çŠ¶æ€ Emoji ä½¿ç”¨ `get_status_emoji()` æ–¹æ³•

**æŒ‰é’®é…ç½®ï¼š**
- [ ] æŒ‰é’®æ–‡æœ¬ä½¿ç”¨ `ButtonConfig` å®šä¹‰
- [ ] æŒ‰é’®æ’åˆ—ç¬¦åˆè®¾è®¡è§„èŒƒ
- [ ] æŒ‰é’®å›è°ƒæ­£ç¡®ç»‘å®š

**è¾“å…¥éªŒè¯ï¼š**
- [ ] æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ç»è¿‡éªŒè¯
- [ ] ä½¿ç”¨ `Validators` ç±»è¿›è¡ŒéªŒè¯
- [ ] éªŒè¯å¤±è´¥è¿”å›å‹å¥½é”™è¯¯æ¶ˆæ¯

**é”™è¯¯å¤„ç†ï¼š**
- [ ] æ‰€æœ‰å¯èƒ½å‡ºé”™çš„åœ°æ–¹éƒ½æœ‰ try-except
- [ ] é”™è¯¯æ¶ˆæ¯è¯¦ç»†ä¸”å‹å¥½
- [ ] æä¾›è§£å†³å»ºè®®å’Œä¸‹ä¸€æ­¥æ“ä½œ

### 6.2 æµ‹è¯•è®¡åˆ’

#### å•å…ƒæµ‹è¯•

**æµ‹è¯•èŒƒå›´ï¼š**
- æ¶ˆæ¯æ ¼å¼åŒ–å‡½æ•°
- è¾“å…¥éªŒè¯å‡½æ•°
- å·¥å…·å‡½æ•°

**æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹ï¼š**

```python
# tests/test_validators.py

import pytest
from bot.func_helper.validators import Validators

def test_validate_username():
    # æœ‰æ•ˆç”¨æˆ·å
    assert Validators.validate_username("è‹è‹").is_valid
    assert Validators.validate_username("User123").is_valid
    assert Validators.validate_username("æµ‹è¯•_ç”¨æˆ·").is_valid

    # æ— æ•ˆç”¨æˆ·å
    assert not Validators.validate_username("a").is_valid  # å¤ªçŸ­
    assert not Validators.validate_username("a" * 25).is_valid  # å¤ªé•¿
    assert not Validators.validate_username("user@123").is_valid  # ç‰¹æ®Šå­—ç¬¦
    assert not Validators.validate_username("   ").is_valid  # å…¨ç©ºæ ¼

def test_validate_pin():
    # æœ‰æ•ˆå®‰å…¨ç 
    assert Validators.validate_pin("1234").is_valid
    assert Validators.validate_pin("123456").is_valid

    # æ— æ•ˆå®‰å…¨ç 
    assert not Validators.validate_pin("123").is_valid  # å¤ªçŸ­
    assert not Validators.validate_pin("1234567").is_valid  # å¤ªé•¿
    assert not Validators.validate_pin("abcd").is_valid  # éæ•°å­—

def test_parse_username_pin():
    # æ­£ç¡®æ ¼å¼
    username, pin, error = Validators.parse_username_pin("è‹è‹ 1234")
    assert username == "è‹è‹"
    assert pin == "1234"
    assert error is None

    # é”™è¯¯æ ¼å¼
    username, pin, error = Validators.parse_username_pin("è‹è‹1234")
    assert username is None
    assert pin is None
    assert error is not None
```

#### é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯ï¼š**
1. æ–°ç”¨æˆ·æ³¨å†Œæµç¨‹
2. ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢
3. å¯†ç é‡ç½®æµç¨‹
4. å…‘æ¢ç ä½¿ç”¨
5. ç®¡ç†å‘˜æ“ä½œ

**æµ‹è¯•ç”¨ä¾‹ï¼š**

```python
# tests/integration/test_user_flow.py

async def test_new_user_registration():
    """æµ‹è¯•æ–°ç”¨æˆ·æ³¨å†Œæµç¨‹"""

    # 1. é¦–æ¬¡ /start
    response = await send_command("/start")
    assert "æ¬¢è¿" in response.text
    assert "åˆ›å»ºè´¦æˆ·" in response.buttons

    # 2. ç‚¹å‡»åˆ›å»ºè´¦æˆ·
    response = await click_button("åˆ›å»ºè´¦æˆ·")
    assert "è¯·åœ¨" in response.text
    assert "ç”¨æˆ·å å®‰å…¨ç " in response.text

    # 3. è¾“å…¥ç”¨æˆ·åå’Œå®‰å…¨ç 
    response = await send_message("æµ‹è¯•ç”¨æˆ· 1234")
    assert "åˆ›å»ºè´¦æˆ·" in response.text or "åˆ›å»ºæˆåŠŸ" in response.text

    # 4. éªŒè¯è´¦æˆ·åˆ›å»ºæˆåŠŸ
    user = get_user_by_name("æµ‹è¯•ç”¨æˆ·")
    assert user is not None
    assert user.emby_name == "æµ‹è¯•ç”¨æˆ·"
```

#### ç”¨æˆ·éªŒæ”¶æµ‹è¯•

**æµ‹è¯•è§’è‰²ï¼š**
- æ–°ç”¨æˆ·
- æ™®é€šç”¨æˆ·
- ç®¡ç†å‘˜
- è¶…çº§ç®¡ç†å‘˜

**æµ‹è¯•å†…å®¹ï¼š**
1. æ‰€æœ‰å‘½ä»¤æ˜¯å¦æ­£å¸¸å·¥ä½œ
2. æŒ‰é’®æ˜¯å¦æ­£ç¡®å“åº”
3. é”™è¯¯æç¤ºæ˜¯å¦æ¸…æ™°
4. å¸®åŠ©æ–‡æ¡£æ˜¯å¦å®Œå–„
5. ç•Œé¢æ˜¯å¦å‹å¥½

### 6.3 æ€§èƒ½æµ‹è¯•

**æµ‹è¯•æŒ‡æ ‡ï¼š**
- æ¶ˆæ¯å‘é€å“åº”æ—¶é—´ < 1s
- æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ < 500ms
- å¹¶å‘ç”¨æˆ·æ”¯æŒ > 100
- å†…å­˜ä½¿ç”¨ < 512MB

**æµ‹è¯•å·¥å…·ï¼š**
- locust (è´Ÿè½½æµ‹è¯•)
- pytest-benchmark (æ€§èƒ½åŸºå‡†)

---

## ä¸ƒã€é¢„æœŸæ•ˆæœ

### 7.1 ç”¨æˆ·ä½“éªŒæ”¹è¿›

**æ”¹è¿›å‰ï¼š**
- âŒ é”™è¯¯æç¤ºç®€å•ï¼Œä¸çŸ¥é“åŸå› 
- âŒ æ“ä½œæµç¨‹å¤æ‚ï¼Œéœ€è¦å¤šæ¬¡è¾“å…¥
- âŒ ç•Œé¢é£æ ¼ä¸ç»Ÿä¸€
- âŒ ç¼ºå°‘å¸®åŠ©æ–‡æ¡£

**æ”¹è¿›åï¼š**
- âœ… é”™è¯¯æç¤ºè¯¦ç»†ï¼ŒåŒ…å«åŸå› å’Œè§£å†³æ–¹æ¡ˆ
- âœ… ä¼˜åŒ–æµç¨‹ï¼Œå‡å°‘ç”¨æˆ·è¾“å…¥
- âœ… ç•Œé¢ç»Ÿä¸€ç¾è§‚
- âœ… å®Œå–„çš„å¸®åŠ©ç³»ç»Ÿ

### 7.2 ä»£ç è´¨é‡æå‡

**æ”¹è¿›å‰ï¼š**
- âŒ æ¶ˆæ¯æ–‡æœ¬ç¡¬ç¼–ç 
- âŒ é‡å¤ä»£ç å¤š
- âŒ éš¾ä»¥ç»´æŠ¤
- âŒ æ‰©å±•å›°éš¾

**æ”¹è¿›åï¼š**
- âœ… æ¶ˆæ¯é›†ä¸­ç®¡ç†
- âœ… é«˜åº¦å¤ç”¨çš„å·¥å…·å‡½æ•°
- âœ… æ˜“äºç»´æŠ¤å’Œä¿®æ”¹
- âœ… æ”¯æŒå¿«é€Ÿæ‰©å±•

### 7.3 é‡åŒ–æŒ‡æ ‡å¯¹æ¯”

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| ç”¨æˆ·æ»¡æ„åº¦ | 70% | 90% | +20% |
| æ“ä½œæˆåŠŸç‡ | 75% | 90% | +15% |
| å¹³å‡æ“ä½œæ—¶é—´ | 120s | 60s | -50% |
| å®¢æœå’¨è¯¢é‡ | 100æ¬¡/å¤© | 30æ¬¡/å¤© | -70% |
| ä»£ç é‡å¤ç‡ | 30% | 5% | -25% |
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ | -60% |

---

## å…«ã€é£é™©è¯„ä¼°

### 8.1 æŠ€æœ¯é£é™©

| é£é™© | ç­‰çº§ | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| æ¶ˆæ¯æ¨¡æ¿ç³»ç»Ÿå…¼å®¹æ€§ | ä½ | éƒ¨åˆ†åŠŸèƒ½å¤±æ•ˆ | å……åˆ†æµ‹è¯•ï¼Œä¿ç•™å›é€€æ–¹æ¡ˆ |
| æ•°æ®åº“è¿ç§»å¤±è´¥ | ä¸­ | æ•°æ®ä¸¢å¤± | å®Œæ•´å¤‡ä»½ï¼Œåˆ†æ­¥è¿ç§» |
| æ€§èƒ½ä¸‹é™ | ä½ | å“åº”å˜æ…¢ | æ€§èƒ½æµ‹è¯•ï¼Œä¼˜åŒ–æŸ¥è¯¢ |
| ç¬¬ä¸‰æ–¹ä¾èµ–æ›´æ–° | ä½ | åŠŸèƒ½å¼‚å¸¸ | ç‰ˆæœ¬é”å®šï¼Œæµ‹è¯•ç¯å¢ƒéªŒè¯ |

### 8.2 ä¸šåŠ¡é£é™©

| é£é™© | ç­‰çº§ | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| ç”¨æˆ·ä¸é€‚åº”æ–°ç•Œé¢ | ä¸­ | ç”¨æˆ·æµå¤± | ç°åº¦å‘å¸ƒï¼Œæ”¶é›†åé¦ˆ |
| æ–°åŠŸèƒ½ Bug | ä¸­ | å½±å“ä½¿ç”¨ | å……åˆ†æµ‹è¯•ï¼Œå¿«é€Ÿä¿®å¤ |
| æ–‡æ¡£ä¸å®Œå–„ | ä½ | ç”¨æˆ·å›°æƒ‘ | åŠæ—¶è¡¥å……ï¼ŒæŒç»­ä¼˜åŒ– |

### 8.3 é£é™©ç¼“è§£ç­–ç•¥

**1. ç°åº¦å‘å¸ƒ**
- å…ˆå‘å¸ƒç»™ 10% ç”¨æˆ·
- æ”¶é›†åé¦ˆï¼Œä¿®å¤é—®é¢˜
- é€æ­¥æ‰©å¤§åˆ° 50%ã€100%

**2. å¿«é€Ÿå›æ»š**
- ä¿ç•™æ—§ç‰ˆæœ¬ä»£ç 
- å‡†å¤‡å›æ»šè„šæœ¬
- 5 åˆ†é’Ÿå†…å¯å›é€€

**3. ç›‘æ§å‘Šè­¦**
- å®æ—¶ç›‘æ§é”™è¯¯ç‡
- ç”¨æˆ·åé¦ˆåŠæ—¶å¤„ç†
- å…³é”®æŒ‡æ ‡å¼‚å¸¸æŠ¥è­¦

**4. ç”¨æˆ·åŸ¹è®­**
- å‘å¸ƒæ›´æ–°å…¬å‘Š
- æä¾›ä½¿ç”¨æŒ‡å—
- è®¾ç«‹åé¦ˆæ¸ é“

---

## é™„å½•

### é™„å½• Aï¼šæœ¯è¯­è¡¨

| æœ¯è¯­ | è¯´æ˜ |
|------|------|
| æ¶ˆæ¯æ¨¡æ¿ | é¢„å®šä¹‰çš„æ¶ˆæ¯æ–‡æœ¬ï¼Œæ”¯æŒå‚æ•°æ›¿æ¢ |
| Emoji è§„èŒƒ | ç»Ÿä¸€çš„ Emoji ä½¿ç”¨æ ‡å‡† |
| æŒ‰é’®é…ç½® | æ ‡å‡†åŒ–çš„æŒ‰é’®æ–‡æœ¬å’Œå›è°ƒå®šä¹‰ |
| è¿›åº¦è¿½è¸ª | é•¿æ—¶é—´æ“ä½œçš„å®æ—¶è¿›åº¦æ˜¾ç¤º |
| è¾“å…¥éªŒè¯ | å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œæ ¼å¼å’Œå†…å®¹æ£€æŸ¥ |

### é™„å½• Bï¼šå‚è€ƒèµ„æ–™

- [Telegram Bot API æ–‡æ¡£](https://core.telegram.org/bots/api)
- [Pyrogram æ–‡æ¡£](https://docs.pyrogram.org)
- [Python ç¼–ç è§„èŒƒ PEP 8](https://www.python.org/dev/peps/pep-0008/)
- [Markdown è¯­æ³•](https://www.markdownguide.org)

### é™„å½• Cï¼šé…ç½®ç¤ºä¾‹

**config.json æ–°å¢é…ç½®é¡¹ï¼š**

```json
{
  "messages": {
    "language": "zh_CN",
    "custom_welcome": null,
    "custom_help": null
  },
  "ui": {
    "button_style": "standard",
    "emoji_enabled": true,
    "progress_enabled": true
  },
  "validation": {
    "username_min_length": 2,
    "username_max_length": 20,
    "pin_min_length": 4,
    "pin_max_length": 6
  }
}
```

### é™„å½• Dï¼šè¿ç§»æ¸…å•

**é˜¶æ®µä¸€å®Œæˆåï¼š**
- [ ] `bot/constants/` ç›®å½•åˆ›å»ºå®Œæˆ
- [ ] `messages.py` åŒ…å«æ‰€æœ‰æ¶ˆæ¯æ¨¡æ¿
- [ ] `emojis.py` å®šä¹‰æ‰€æœ‰ Emoji
- [ ] `buttons.py` é…ç½®æ‰€æœ‰æŒ‰é’®
- [ ] `message_formatter.py` å·¥å…·å‡½æ•°å°±ç»ª
- [ ] `validators.py` éªŒè¯å™¨å°±ç»ª

**é˜¶æ®µäºŒå®Œæˆåï¼š**
- [ ] æ‰€æœ‰å‘½ä»¤å¤„ç†å™¨å·²æ›´æ–°
- [ ] æ‰€æœ‰é¢æ¿æ¨¡å—å·²æ›´æ–°
- [ ] æŒ‰é’®é£æ ¼å·²ç»Ÿä¸€
- [ ] é”™è¯¯æç¤ºå·²ä¼˜åŒ–

**é˜¶æ®µä¸‰å®Œæˆåï¼š**
- [ ] å¸®åŠ©æ–‡æ¡£å·²åˆ›å»º
- [ ] FAQ æ–‡æ¡£å·²åˆ›å»º
- [ ] /help å‘½ä»¤å·²å®ç°
- [ ] æ–°ç”¨æˆ·å¼•å¯¼å·²ä¼˜åŒ–

**é˜¶æ®µå››å®Œæˆåï¼š**
- [ ] è¿›åº¦è¿½è¸ªå·²å®ç°
- [ ] å®¡è®¡æŠ¥å‘Šå·²ä¼˜åŒ–
- [ ] æ“ä½œç¡®è®¤å·²æ·»åŠ 

---

## ç»“è¯­

æœ¬ä¼˜åŒ–æ–¹æ¡ˆæ—¨åœ¨å…¨é¢æå‡ EmbyBot çš„ç”¨æˆ·ä½“éªŒå’Œä»£ç è´¨é‡ã€‚é€šè¿‡ç³»ç»ŸåŒ–çš„æ¶ˆæ¯ç®¡ç†ã€ç»Ÿä¸€çš„ç•Œé¢é£æ ¼ã€å®Œå–„çš„å¸®åŠ©ç³»ç»Ÿå’Œå‹å¥½çš„é”™è¯¯æç¤ºï¼Œå°†æ˜¾è‘—æ”¹å–„ç”¨æˆ·ä½¿ç”¨ä½“éªŒã€‚

åŒæ—¶ï¼Œé€šè¿‡å¼•å…¥å¯å¤ç”¨çš„å·¥å…·å‡½æ•°ã€è§„èŒƒåŒ–çš„ä»£ç ç»“æ„å’Œå®Œå–„çš„æµ‹è¯•ä½“ç³»ï¼Œå°†å¤§å¹…æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

å»ºè®®æŒ‰ç…§æœ¬æ–¹æ¡ˆåˆ†é˜¶æ®µå®æ–½ï¼Œç¡®ä¿æ¯ä¸ªé˜¶æ®µçš„è´¨é‡ï¼Œæœ€ç»ˆå®ç°é¡¹ç›®çš„å…¨é¢å‡çº§ã€‚

---

**æ–‡æ¡£ç»´æŠ¤ï¼š**
- æœ¬æ–‡æ¡£å°†éšé¡¹ç›®è¿›å±•æŒç»­æ›´æ–°
- æ¬¢è¿æå‡ºæ”¹è¿›å»ºè®®
- æœ€æ–°ç‰ˆæœ¬ï¼šv1.0 (2025-11-24)
